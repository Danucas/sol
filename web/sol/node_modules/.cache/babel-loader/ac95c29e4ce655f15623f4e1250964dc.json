{"ast":null,"code":"var _jsxFileName = \"/home/dan/Documents/sol/sol/src/App.js\";\nimport React, { useRef } from 'react';\nimport ReactDOM from 'react-dom';\nimport * as tf from \"@tensorflow/tfjs\";\nimport * as bodyPix from \"@tensorflow-models/body-pix\";\nimport Webcam from \"react-webcam\";\nimport './App.css';\nimport menuStyles from './Menu.module.css';\nimport videoStyles from './VideoFrame.module.css';\nimport backVideo from './airport.mp4';\nconst root = document.getElementById('root');\n\nfunction VideoFrame() {\n  const loadingRef = useRef(null);\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const backVideoRef = useRef(null);\n  let render = false;\n  let currentMask;\n  const dimensions = [window.innerWidth, window.innerHeight];\n  let cropedDimensions;\n  console.log(dimensions);\n  const videoConstraints = {\n    width: dimensions[0],\n    height: dimensions[1],\n    facingMode: \"user\"\n  }; // Navigation\n\n  const back = () => {\n    stop();\n    ReactDOM.render( /*#__PURE__*/React.createElement(MainView, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 37,\n        columnNumber: 5\n      }\n    }), root);\n  };\n  /**\n   * runBodySegment - startpoint for the background extraction\n   */\n\n\n  const runBodySegment = async () => {\n    loadingRef.current.style.visibility = 'visible';\n    render = true;\n    const net = await bodyPix.load();\n\n    if (backVideoRef.current) {\n      backVideoRef.current.play();\n    }\n\n    const interval = setInterval(() => {\n      if (render) {\n        loadingRef.current.style.visibility = 'hidden';\n        detect(net);\n      } else {\n        clearInterval(interval);\n      }\n    }, 70);\n  };\n  /**\n   * backMask - utility to apply the mask and compose the image using the video background\n   * @param {ImageData} image \n   * @param {ImageData} mask \n   * @returns {ImageData} image - after the mask is applied\n   */\n\n\n  const backMask = (image, mask) => {\n    console.log(image, mask);\n    const cv = document.createElement('canvas');\n    cv.style.width = image.width;\n    cv.style.height = image.height;\n    cv.width = image.width;\n    cv.height = image.height;\n    const ctx = cv.getContext('2d');\n\n    try {\n      ctx.drawImage(backVideoRef.current, 0, 0, cv.width, cv.height);\n    } catch (err) {\n      console.log(err);\n      return null;\n    }\n\n    const imageData = ctx.getImageData(0, 0, cv.width, cv.height); // console.log(image, mask);\n\n    for (let i = 0; i < image.data.length; i += 4) {\n      const vector = [mask.data[i], mask.data[i + 1], mask.data[i + 2], mask.data[i + 3]];\n\n      if (vector[0] === 255 && vector[1] === 255 && vector[2] === 255) {\n        image.data[i] = imageData.data[i];\n        image.data[i + 1] = imageData.data[i + 1];\n        image.data[i + 2] = imageData.data[i + 2];\n        image.data[i + 3] = imageData.data[i + 3];\n      }\n    }\n\n    return image;\n  };\n  /**\n   * detect - prediction for each WebCam frame\n   * @param {TensorFlowNet} net \n   */\n\n\n  const detect = async net => {\n    if (typeof webcamRef.current !== \"undefined\" && webcamRef.current !== null && webcamRef.current.video.readyState === 4) {\n      const videoTrack = webcamRef.current.stream.getVideoTracks()[0];\n      videoTrack.applyConstraints(videoConstraints);\n      const video = webcamRef.current.video;\n      const videoHeight = video.videoHeight;\n      const videoWidth = video.videoWidth;\n      cropedDimensions = [videoWidth, videoHeight];\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight;\n      canvasRef.current.width = videoWidth;\n      canvasRef.current.height = videoHeight;\n      const outStride = 16;\n      const segThreshold = 0.5;\n      const cv = document.createElement('canvas');\n      cv.style.width = videoWidth;\n      cv.style.height = videoHeight;\n      cv.width = videoWidth;\n      cv.height = videoHeight;\n      const ctx = cv.getContext('2d');\n      ctx.drawImage(video, 0, 0, cv.width, cv.height);\n      const imageData = ctx.getImageData(0, 0, cv.width, cv.height);\n      const person = await net.segmentPersonParts(video, outStride, segThreshold);\n      const coloredPart = bodyPix.toColoredPartMask(person);\n      const back = backMask(imageData, coloredPart);\n\n      if (!back) {\n        return;\n      }\n\n      const ctx2 = canvasRef.current.getContext('2d');\n      ctx2.putImageData(back, 0, 0);\n    }\n  };\n  /**\n   * stop - Stop each streaming Track and sets render as false to stop detection\n   */\n\n\n  const stopDetection = () => {\n    render = false;\n  };\n\n  const stop = () => {\n    render = false;\n    backVideoRef.current.pause();\n    const tracks = webcamRef.current.stream.getTracks();\n    console.log(tracks);\n\n    for (const track of tracks) {\n      track.stop();\n    }\n  }; // runBodySegment();\n\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: videoStyles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: videoStyles.loading,\n    ref: loadingRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 5\n    }\n  }), /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 5\n    }\n  }, \"Loading...\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: videoStyles.back,\n    onClick: () => {\n      back();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 4\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: videoStyles.toolsMenu,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(\"li\", {\n    className: videoStyles.save,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"li\", {\n    className: videoStyles.back_remove,\n    onClick: () => {\n      runBodySegment();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"li\", {\n    className: videoStyles.other,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 7\n    }\n  }))), /*#__PURE__*/React.createElement(Webcam, {\n    ref: webcamRef,\n    className: videoStyles.webcam,\n    videoConstraints: videoConstraints,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 5\n    }\n  }), /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      position: \"absolute\",\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zIndex: 9,\n      width: \"100%\",\n      height: \"100%\",\n      backgroundColor: \"transparent\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 5\n    }\n  }), /*#__PURE__*/React.createElement(\"video\", {\n    ref: backVideoRef,\n    style: {\n      visibility: \"hidden\",\n      position: \"absolute\",\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zIndex: 8,\n      width: \"100%\",\n      height: \"100%\",\n      objectFit: \"cover\"\n    },\n    width: dimensions[0],\n    height: dimensions[1],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"source\", {\n    src: backVideo,\n    type: \"video/mp4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 6\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: videoStyles.controls,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: videoStyles.deleteBtn,\n    onClick: () => {},\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 6\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: videoStyles.recordBtn,\n    onClick: () => {},\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 6\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: videoStyles.galleryBtn,\n    onClick: () => {},\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 6\n    }\n  })));\n}\n\nclass MainView extends React.Component {\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: menuStyles.menu,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.gallery,\n      onClick: () => {\n        this.gallery();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.creator,\n      onClick: () => {\n        this.creator();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.user,\n      onClick: () => {\n        this.user();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 5\n      }\n    }));\n  }\n\n  gallery() {}\n\n  creator() {\n    ReactDOM.render( /*#__PURE__*/React.createElement(VideoFrame, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 5\n      }\n    }), root);\n  }\n\n  user() {}\n\n}\n\nfunction App() {\n  const renderVideoCapture = () => {\n    React.render( /*#__PURE__*/React.createElement(VideoFrame, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 5\n      }\n    }), root);\n  };\n\n  return /*#__PURE__*/React.createElement(MainView, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 2\n    }\n  });\n}\n\nexport default App;","map":{"version":3,"sources":["/home/dan/Documents/sol/sol/src/App.js"],"names":["React","useRef","ReactDOM","tf","bodyPix","Webcam","menuStyles","videoStyles","backVideo","root","document","getElementById","VideoFrame","loadingRef","webcamRef","canvasRef","backVideoRef","render","currentMask","dimensions","window","innerWidth","innerHeight","cropedDimensions","console","log","videoConstraints","width","height","facingMode","back","stop","runBodySegment","current","style","visibility","net","load","play","interval","setInterval","detect","clearInterval","backMask","image","mask","cv","createElement","ctx","getContext","drawImage","err","imageData","getImageData","i","data","length","vector","video","readyState","videoTrack","stream","getVideoTracks","applyConstraints","videoHeight","videoWidth","outStride","segThreshold","person","segmentPersonParts","coloredPart","toColoredPartMask","ctx2","putImageData","stopDetection","pause","tracks","getTracks","track","container","loading","toolsMenu","save","back_remove","other","webcam","position","left","right","textAlign","zIndex","backgroundColor","objectFit","controls","deleteBtn","recordBtn","galleryBtn","MainView","Component","menu","gallery","creator","user","App","renderVideoCapture"],"mappings":"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","sourcesContent":["import React, { useRef } from 'react';\nimport ReactDOM from 'react-dom'; \nimport * as tf from \"@tensorflow/tfjs\";\nimport * as bodyPix from \"@tensorflow-models/body-pix\";\nimport Webcam from \"react-webcam\";\nimport './App.css';\nimport menuStyles from './Menu.module.css';\nimport videoStyles from './VideoFrame.module.css';\nimport backVideo from './airport.mp4';\n\nconst root = document.getElementById('root');\n\nfunction VideoFrame () {\n\tconst loadingRef = useRef(null);\n\tconst webcamRef = useRef(null);\n\tconst canvasRef = useRef(null);\n\tconst backVideoRef = useRef(null);\n\tlet render = false;\n\tlet currentMask;\n\n\tconst dimensions = [window.innerWidth, window.innerHeight];\n\tlet cropedDimensions;\n\tconsole.log(dimensions);\n\n\tconst videoConstraints = {\n\t\twidth: dimensions[0],\n\t\theight: dimensions[1],\n\t\tfacingMode: \"user\"\n\t}\n\n\t// Navigation\n\n\tconst back = () => {\n\t\tstop();\n\t\tReactDOM.render(\n\t\t\t(\n\t\t\t\t<MainView></MainView>\n\t\t\t),\n\t\t\troot\n\t\t);\n\t}\n\t/**\n\t * runBodySegment - startpoint for the background extraction\n\t */\n\tconst runBodySegment = async () => {\n\t\tloadingRef.current.style.visibility = 'visible';\n\t\trender = true;\n\t\tconst net = await bodyPix.load();\n\t\tif (backVideoRef.current) {\n\t\t\tbackVideoRef.current.play();\n\t\t}\n\t\tconst interval = setInterval(() => {\n\t\t\tif (render) {\n\t\t\t\tloadingRef.current.style.visibility = 'hidden';\n\t\t\t\tdetect(net);\n\t\t\t} else {\n\t\t\t\tclearInterval(interval);\n\t\t\t}\n\t\t}, 70);\n\t}\n\t/**\n\t * backMask - utility to apply the mask and compose the image using the video background\n\t * @param {ImageData} image \n\t * @param {ImageData} mask \n\t * @returns {ImageData} image - after the mask is applied\n\t */\n\tconst backMask = (image, mask) => {\n\t\tconsole.log(image, mask);\n\t\tconst cv = document.createElement('canvas');\n\t\tcv.style.width = image.width;\n\t\tcv.style.height = image.height;\n\t\tcv.width = image.width;\n\t\tcv.height = image.height;\n\t\tconst ctx = cv.getContext('2d');\n\t\ttry {\n\t\t\tctx.drawImage(backVideoRef.current, 0, 0, cv.width, cv.height);\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t\treturn null;\n\t\t}\n\t\tconst imageData = ctx.getImageData(0, 0, cv.width, cv.height);\n\t\t// console.log(image, mask);\n\t\tfor (let i = 0; i < image.data.length; i+=4) {\n\t\t\tconst vector = [\n\t\t\t\tmask.data[i],\n\t\t\t\tmask.data[i + 1],\n\t\t\t\tmask.data[i + 2],\n\t\t\t\tmask.data[i + 3],\n\t\t\t]\n\t\t\tif (\n\t\t\t\tvector[0] === 255 &&\n\t\t\t\tvector[1] === 255 &&\n\t\t\t\tvector[2] === 255\n\t\t\t\t) {\n\t\t\t\t\timage.data[i] = imageData.data[i];\n\t\t\t\t\timage.data[i + 1] = imageData.data[i + 1];\n\t\t\t\t\timage.data[i + 2] = imageData.data[i + 2];\n\t\t\t\t\timage.data[i + 3] = imageData.data[i + 3];\n\t\t\t}\n\t\t}\n\t\treturn image;\n\t}\n\t/**\n\t * detect - prediction for each WebCam frame\n\t * @param {TensorFlowNet} net \n\t */\n\tconst detect = async (net) => {\n\t\tif (\n\t\t\ttypeof webcamRef.current !== \"undefined\" &&\n\t\t\twebcamRef.current !== null &&\n\t\t\twebcamRef.current.video.readyState === 4\n\t\t\t) {\n\t\t\t\tconst videoTrack = webcamRef.current.stream.getVideoTracks()[0];\n\t\t\t\tvideoTrack.applyConstraints(videoConstraints);\n\t\t\t\tconst video = webcamRef.current.video;\n\t\t\t\tconst videoHeight = video.videoHeight;\n\t\t\t\tconst videoWidth = video.videoWidth;\n\t\t\t\tcropedDimensions = [videoWidth, videoHeight];\n\t\t\t\twebcamRef.current.video.width = videoWidth;\n\t\t\t\twebcamRef.current.video.height = videoHeight;\n\t\t\t\tcanvasRef.current.width = videoWidth;\n\t\t\t\tcanvasRef.current.height = videoHeight;\n\t\t\t\tconst outStride = 16;\n\t\t\t\tconst segThreshold = 0.5;\n\t\t\t\tconst cv = document.createElement('canvas');\n\t\t\t\tcv.style.width = videoWidth;\n\t\t\t\tcv.style.height = videoHeight;\n\t\t\t\tcv.width = videoWidth;\n\t\t\t\tcv.height = videoHeight;\n\t\t\t\tconst ctx = cv.getContext('2d');\n\t\t\t\tctx.drawImage(video, 0, 0, cv.width, cv.height);\n\t\t\t\tconst imageData = ctx.getImageData(0, 0, cv.width, cv.height);\n\t\t\t\tconst person = await net.segmentPersonParts(video, outStride, segThreshold);\n\t\t\t\tconst coloredPart = bodyPix.toColoredPartMask(person);\n\t\t\t\tconst back = backMask(imageData, coloredPart);\n\t\t\t\tif (!back) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst ctx2 = canvasRef.current.getContext('2d');\n\t\t\t\tctx2.putImageData(back, 0, 0);\n\t\t\t}\n\t}\n\t/**\n\t * stop - Stop each streaming Track and sets render as false to stop detection\n\t */\n\tconst stopDetection = () => {\n\t\trender = false;\n\t}\n\tconst stop = () => {\n\t\trender = false;\n\t\tbackVideoRef.current.pause();\n\t\tconst tracks = webcamRef.current.stream.getTracks();\n\t\tconsole.log(tracks);\n\t\tfor (const track of tracks) {\n\t\t\ttrack.stop();\n\t\t}\n\t}\n\t// runBodySegment();\n\treturn (\n\t\t\t<div className={ videoStyles.container }>\n\t\t\t<div className={ videoStyles.loading } ref={loadingRef}>\n\t\t\t\t<h1></h1>\n\t\t\t\t<h2>Loading...</h2>\n\t\t\t</div>\n\t\t\t<div className={ videoStyles.back } onClick={() => { back() }}></div>\n\t\t\t\t<div className={ videoStyles.toolsMenu }>\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li className={ videoStyles.save }></li>\n\t\t\t\t\t\t<li className={ videoStyles.back_remove } onClick={ ()=>{runBodySegment()} }></li>\n\t\t\t\t\t\t<li className={ videoStyles.other }></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t<Webcam ref={webcamRef} className={ videoStyles.webcam }\n\t\t\t\t\tvideoConstraints={ videoConstraints }\n\t\t\t\t\t/>\n\t\t\t\t<canvas ref={canvasRef}\n\t\t\t\t\tstyle = {{\n\t\t\t\t\t\tposition:\"absolute\",\n\t\t\t\t\t\tleft:0,\n\t\t\t\t\t\tright:0,\n\t\t\t\t\t\ttextAlign:\"center\",\n\t\t\t\t\t\tzIndex:9,\n\t\t\t\t\t\twidth:\"100%\",\n\t\t\t\t\t\theight:\"100%\",\n\t\t\t\t\t\tbackgroundColor: \"transparent\"\n\t\t\t\t\t}} />\n\t\t\t\t<video \n\t\t\t\t\tref={ backVideoRef }\n\t\t\t\t\tstyle = {{\n\t\t\t\t\t\tvisibility: \"hidden\",\n\t\t\t\t\t\tposition:\"absolute\",\n\t\t\t\t\t\tleft:0,\n\t\t\t\t\t\tright:0,\n\t\t\t\t\t\ttextAlign:\"center\",\n\t\t\t\t\t\tzIndex:8,\n\t\t\t\t\t\twidth:\"100%\",\n\t\t\t\t\t\theight:\"100%\",\n\t\t\t\t\t\tobjectFit:\"cover\"\n\t\t\t\t\t}}\n\t\t\t\t\twidth={ dimensions[0] }\n\t\t\t\t\theight={ dimensions[1] }\n\t\t\t\t\t>\n\t\t\t\t\t<source src={ backVideo } type=\"video/mp4\"/>\n\t\t\t\t</video>\n\t\t\t\t<div className={ videoStyles.controls }>\n\t\t\t\t\t<button className={ videoStyles.deleteBtn } onClick={()=> {} }></button>\n\t\t\t\t\t<button className={ videoStyles.recordBtn } onClick={()=> {}}></button>\n\t\t\t\t\t<button className={ videoStyles.galleryBtn } onClick={()=> {}}></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n}\n\nclass MainView extends React.Component {\n\trender () {\n\t\treturn (\n\t\t\t<div className={ menuStyles.menu }>\n\t\t\t\t<button className={ menuStyles.gallery } onClick={()=>{this.gallery()}}></button>\n\t\t\t\t<button className={ menuStyles.creator } onClick={()=>{this.creator()}}></button>\n\t\t\t\t<button className={ menuStyles.user } onClick={()=>{this.user()}}></button>\n\t\t\t</div>\n\t\t);\n\t}\n\tgallery () {\n\n\t}\n\tcreator () {\n\t\tReactDOM.render(\n\t\t\t(\n\t\t\t\t<VideoFrame></VideoFrame>\n\t\t\t),\n\t\t\troot\n\t\t);\n\t}\n\tuser () {\n\n\t}\n}\n\nfunction App() {\n\tconst renderVideoCapture = () => {\n\t\tReact.render(\n\t\t\t(\n\t\t\t\t<VideoFrame>\n\t\t\t\t</VideoFrame>\n\t\t\t),\n\t\t\troot\n\t\t)\n\t};\n  return (\n\t<MainView></MainView>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}