{"ast":null,"code":"var _jsxFileName = \"/home/dan/Documents/sol/sol/src/App.js\";\nimport React, { useRef } from 'react';\nimport * as tf from \"@tensorflow/tfjs\";\nimport * as bodyPix from \"@tensorflow-models/body-pix\";\nimport Webcam from \"react-webcam\";\nimport './App.css';\nimport menuStyles from './Menu.module.css';\nimport backVideo from './airport.mp4';\nconst root = document.getElementById('root');\n\nfunction VideoFrame() {\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const backVideoRef = useRef(null);\n  let render = false;\n  let currentMask;\n\n  const runBodySegment = async () => {\n    render = true;\n    const net = await bodyPix.load(); // console.log(backVideoRef);\n\n    if (backVideoRef.current) {\n      backVideoRef.current.play();\n    } // backVideoRef.play();\n    // detect(net);\n\n\n    const interval = setInterval(() => {\n      if (render) {\n        detect(net);\n      } else {\n        clearInterval(interval);\n      }\n    }, 70);\n  };\n\n  const backMask = (image, mask) => {\n    const cv = document.createElement('canvas');\n    cv.width = 640;\n    cv.height = 480;\n    const ctx = cv.getContext('2d');\n    ctx.drawImage(backVideoRef.current, 0, 0, cv.width, cv.height);\n    const imageData = ctx.getImageData(0, 0, cv.width, cv.height); // console.log(image, mask);\n\n    for (let i = 0; i < image.data.length; i += 4) {\n      const vector = [mask.data[i], mask.data[i + 1], mask.data[i + 2], mask.data[i + 3]];\n\n      if (vector[0] === 255 && vector[1] === 255 && vector[2] === 255) {\n        image.data[i] = imageData.data[i];\n        image.data[i + 1] = imageData.data[i + 1];\n        image.data[i + 2] = imageData.data[i + 2];\n        image.data[i + 3] = imageData.data[i + 3];\n      }\n    }\n\n    return image;\n  };\n\n  const detect = async net => {\n    if (typeof webcamRef.current !== \"undefined\" && webcamRef.current !== null && webcamRef.current.video.readyState === 4) {\n      const video = webcamRef.current.video;\n      const videoHeight = video.videoHeight;\n      const videoWidth = video.videoWidth;\n      webcamRef.current.video.height = videoHeight;\n      webcamRef.current.video.width = videoWidth;\n      canvasRef.current.width = videoWidth;\n      canvasRef.current.height = videoHeight;\n      const outStride = 16;\n      const segThreshold = 0.5;\n      const cv = document.createElement('canvas');\n      cv.width = 640;\n      cv.height = 480;\n      const ctx = cv.getContext('2d');\n      ctx.drawImage(video, 0, 0, cv.width, cv.height);\n      const imageData = ctx.getImageData(0, 0, cv.width, cv.height); // console.log();\n\n      const person = await net.segmentPersonParts(video, outStride, segThreshold); // console.log(person);\n\n      const coloredPart = bodyPix.toColoredPartMask(person);\n      const back = backMask(imageData, coloredPart); // console.log(back);\n\n      const ctx2 = canvasRef.current.getContext('2d'); // console.log(ctx2);\n\n      ctx2.putImageData(back, 0, 0);\n    }\n  };\n\n  const stop = () => {\n    backVideoRef.current.pause();\n    render = false;\n  };\n\n  navigator.getUserMedia({\n    audio: true,\n    video: true\n  }, function () {\n    console.log('has permission');\n  }, err => {\n    console.log(err);\n  });\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(Webcam, {\n    ref: webcamRef,\n    style: {\n      position: \"absolute\",\n      marginLeft: 0,\n      marginRight: 0,\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zIndex: 9,\n      width: 640,\n      height: 480\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 4\n    }\n  }), /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      position: \"absolute\",\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zIndex: 9,\n      width: 640,\n      height: 480,\n      backgroundColor: \"transparent\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 5\n    }\n  }), /*#__PURE__*/React.createElement(\"video\", {\n    ref: backVideoRef,\n    style: {\n      visibility: \"hidden\",\n      position: \"absolute\",\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n      zIndex: 8,\n      width: 640,\n      height: 480,\n      objectFit: \"cover\"\n    },\n    width: \"640\",\n    height: \"480\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"source\", {\n    src: backVideo,\n    type: \"video/mp4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 6\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"controls\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => {\n      runBodySegment();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 6\n    }\n  }, \"start\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => {\n      stop();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 6\n    }\n  }, \"stop\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => {},\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 6\n    }\n  }, \"record\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => {},\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 6\n    }\n  }, \"save\")));\n}\n\nclass MainView extends React.Component {\n  render() {\n    document.body.requestFullscreen();\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: menuStyles.menu,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.gallery,\n      onClick: () => {\n        this.gallery();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.creator,\n      onClick: () => {\n        this.creator();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.user,\n      onClick: () => {\n        this.user();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 5\n      }\n    }));\n  }\n\n  gallery() {}\n\n  creator() {}\n\n  user() {}\n\n}\n\nfunction App() {\n  const renderVideoCapture = () => {\n    React.render( /*#__PURE__*/React.createElement(VideoFrame, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 5\n      }\n    }), root);\n  };\n\n  return /*#__PURE__*/React.createElement(MainView, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 2\n    }\n  });\n}\n\nexport default App;","map":{"version":3,"sources":["/home/dan/Documents/sol/sol/src/App.js"],"names":["React","useRef","tf","bodyPix","Webcam","menuStyles","backVideo","root","document","getElementById","VideoFrame","webcamRef","canvasRef","backVideoRef","render","currentMask","runBodySegment","net","load","current","play","interval","setInterval","detect","clearInterval","backMask","image","mask","cv","createElement","width","height","ctx","getContext","drawImage","imageData","getImageData","i","data","length","vector","video","readyState","videoHeight","videoWidth","outStride","segThreshold","person","segmentPersonParts","coloredPart","toColoredPartMask","back","ctx2","putImageData","stop","pause","navigator","getUserMedia","audio","console","log","err","position","marginLeft","marginRight","left","right","textAlign","zIndex","backgroundColor","visibility","objectFit","MainView","Component","body","requestFullscreen","menu","gallery","creator","user","App","renderVideoCapture"],"mappings":"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","sourcesContent":["import React, { useRef } from 'react';\nimport * as tf from \"@tensorflow/tfjs\";\nimport * as bodyPix from \"@tensorflow-models/body-pix\";\nimport Webcam from \"react-webcam\";\nimport './App.css';\nimport menuStyles from './Menu.module.css';\nimport backVideo from './airport.mp4';\n\nconst root = document.getElementById('root');\n\nfunction VideoFrame () {\n\tconst webcamRef = useRef(null);\n\tconst canvasRef = useRef(null);\n\tconst backVideoRef = useRef(null);\n\tlet render = false;\n\tlet currentMask;\n\n\tconst runBodySegment = async () => {\n\t\trender = true;\n\t\tconst net = await bodyPix.load();\n\t\t// console.log(backVideoRef);\n\t\tif (backVideoRef.current) {\n\t\t\tbackVideoRef.current.play();\n\t\t}\n\t\t// backVideoRef.play();\n\t\t// detect(net);\n\t\tconst interval = setInterval(() => {\n\t\t\tif (render) {\n\t\t\t\tdetect(net);\n\t\t\t} else {\n\t\t\t\tclearInterval(interval);\n\t\t\t}\n\t\t}, 70);\n\t}\n\tconst backMask = (image, mask) => {\n\t\tconst cv = document.createElement('canvas');\n\t\tcv.width = 640;\n\t\tcv.height = 480;\n\t\tconst ctx = cv.getContext('2d');\n\t\tctx.drawImage(backVideoRef.current, 0, 0, cv.width, cv.height);\n\t\tconst imageData = ctx.getImageData(0, 0, cv.width, cv.height);\n\t\t// console.log(image, mask);\n\t\tfor (let i = 0; i < image.data.length; i+=4) {\n\t\t\tconst vector = [\n\t\t\t\tmask.data[i],\n\t\t\t\tmask.data[i + 1],\n\t\t\t\tmask.data[i + 2],\n\t\t\t\tmask.data[i + 3],\n\t\t\t]\n\t\t\tif (\n\t\t\t\tvector[0] === 255 &&\n\t\t\t\tvector[1] === 255 &&\n\t\t\t\tvector[2] === 255\n\t\t\t\t) {\n\t\t\t\t\timage.data[i] = imageData.data[i];\n\t\t\t\t\timage.data[i + 1] = imageData.data[i + 1];\n\t\t\t\t\timage.data[i + 2] = imageData.data[i + 2];\n\t\t\t\t\timage.data[i + 3] = imageData.data[i + 3];\n\t\t\t}\n\t\t}\n\t\treturn image;\n\t}\n\n\tconst detect = async (net) => {\n\t\tif (\n\t\t\ttypeof webcamRef.current !== \"undefined\" &&\n\t\t\twebcamRef.current !== null &&\n\t\t\twebcamRef.current.video.readyState === 4\n\t\t\t) {\n\t\t\t\tconst video = webcamRef.current.video;\n\t\t\t\tconst videoHeight = video.videoHeight;\n\t\t\t\tconst videoWidth = video.videoWidth;\n\n\t\t\t\twebcamRef.current.video.height = videoHeight;\n\t\t\t\twebcamRef.current.video.width = videoWidth;\n\n\t\t\t\tcanvasRef.current.width = videoWidth;\n\t\t\t\tcanvasRef.current.height = videoHeight;\n\n\t\t\t\tconst outStride = 16;\n\t\t\t\tconst segThreshold = 0.5;\n\t\t\t\tconst cv = document.createElement('canvas');\n\t\t\t\tcv.width = 640;\n\t\t\t\tcv.height = 480;\n\t\t\t\tconst ctx = cv.getContext('2d');\n\t\t\t\tctx.drawImage(video, 0, 0, cv.width, cv.height);\n\t\t\t\tconst imageData = ctx.getImageData(0, 0, cv.width, cv.height);\n\t\t\t\t// console.log();\n\t\t\t\tconst person = await net.segmentPersonParts(video, outStride, segThreshold);\n\t\t\t\t// console.log(person);\n\n\t\t\t\tconst coloredPart = bodyPix.toColoredPartMask(person);\n\t\t\t\tconst back = backMask(imageData, coloredPart);\n\t\t\t\t// console.log(back);\n\t\t\t\tconst ctx2 = canvasRef.current.getContext('2d');\n\t\t\t\t// console.log(ctx2);\n\t\t\t\tctx2.putImageData(back, 0, 0);\n\t\t\t}\n\t}\n\tconst stop = () => {\n\t\tbackVideoRef.current.pause();\n\t\trender = false;\n\t}\n\tnavigator.getUserMedia({audio:true, video:true}, function () {\n\t\tconsole.log('has permission');\n\t}, err => {\n\t\tconsole.log(err);\n\t});\n\n\treturn (\n\t\t\t<div>\n\t\t\t<Webcam ref={webcamRef}\n\t\t\t\t\tstyle = {{\n\t\t\t\t\t\tposition:\"absolute\",\n\t\t\t\t\t\tmarginLeft:0,\n\t\t\t\t\t\tmarginRight:0,\n\t\t\t\t\t\tleft:0,\n\t\t\t\t\t\tright:0,\n\t\t\t\t\t\ttextAlign:\"center\",\n\t\t\t\t\t\tzIndex:9,\n\t\t\t\t\t\twidth:640,\n\t\t\t\t\t\theight:480\n\t\t\t\t\t}} />\n\t\t\t\t<canvas ref={canvasRef}\n\t\t\t\t\tstyle = {{\n\t\t\t\t\t\tposition:\"absolute\",\n\t\t\t\t\t\tleft:0,\n\t\t\t\t\t\tright:0,\n\t\t\t\t\t\ttextAlign:\"center\",\n\t\t\t\t\t\tzIndex:9,\n\t\t\t\t\t\twidth:640,\n\t\t\t\t\t\theight:480,\n\t\t\t\t\t\tbackgroundColor: \"transparent\"\n\t\t\t\t\t}} />\n\t\t\t\t<video \n\t\t\t\t\tref={ backVideoRef }\n\t\t\t\t\tstyle = {{\n\t\t\t\t\t\tvisibility: \"hidden\",\n\t\t\t\t\t\tposition:\"absolute\",\n\t\t\t\t\t\tleft:0,\n\t\t\t\t\t\tright:0,\n\t\t\t\t\t\ttextAlign:\"center\",\n\t\t\t\t\t\tzIndex:8,\n\t\t\t\t\t\twidth:640,\n\t\t\t\t\t\theight:480,\n\t\t\t\t\t\tobjectFit:\"cover\"\n\t\t\t\t\t}}\n\t\t\t\t\twidth=\"640\"\n\t\t\t\t\theight=\"480\">\n\t\t\t\t\t<source src={ backVideo } type=\"video/mp4\"/>\n\t\t\t\t</video>\n\t\t\t\t<div className=\"controls\">\n\t\t\t\t\t<button onClick={()=> {runBodySegment()} }>start</button>\n\t\t\t\t\t<button onClick={()=> {stop()}}>stop</button>\n\t\t\t\t\t<button onClick={()=> {}}>record</button>\n\t\t\t\t\t<button onClick={()=> {}}>save</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n}\n\nclass MainView extends React.Component {\n\trender () {\n\t\tdocument.body.requestFullscreen();\n\t\treturn (\n\t\t\t<div className={ menuStyles.menu }>\n\t\t\t\t<button className={ menuStyles.gallery } onClick={()=>{this.gallery()}}></button>\n\t\t\t\t<button className={ menuStyles.creator } onClick={()=>{this.creator()}}></button>\n\t\t\t\t<button className={ menuStyles.user } onClick={()=>{this.user()}}></button>\n\t\t\t</div>\n\t\t);\n\t}\n\tgallery () {\n\n\t}\n\tcreator () {\n\n\t}\n\tuser () {\n\n\t}\n}\n\nfunction App() {\n\tconst renderVideoCapture = () => {\n\t\tReact.render(\n\t\t\t(\n\t\t\t\t<VideoFrame>\n\t\t\t\t</VideoFrame>\n\t\t\t),\n\t\t\troot\n\t\t)\n\t};\n  return (\n\t<MainView></MainView>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}