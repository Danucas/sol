{"ast":null,"code":"var _jsxFileName = \"/home/dan/Documents/sol/sol/src/App.js\";\nimport React, { useRef } from 'react';\nimport ReactDOM from 'react-dom';\nimport * as tf from \"@tensorflow/tfjs\";\nimport * as bodyPix from \"@tensorflow-models/body-pix\";\nimport Webcam from \"react-webcam\";\nimport './App.css';\nimport menuStyles from './Menu.module.css';\nimport videoStyles from './VideoFrame.module.css';\nimport backVideo from './airport.mp4';\nconst root = document.getElementById('root');\n\nfunction VideoFrame() {\n  const loadingRef = useRef(null);\n  const triggerRef = useRef(null);\n  const galleryRef = useRef(null);\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const backVideoRef = useRef(null);\n  let render = false;\n  let recPressed = false;\n  let recording = false;\n  let currentMask;\n  let recordedframes = [];\n  const dimensions = [window.innerWidth, window.innerHeight];\n  let cropedDimensions;\n  console.log(dimensions);\n  const videoConstraints = {\n    width: dimensions[0],\n    height: dimensions[1],\n    facingMode: \"user\"\n  }; // Navigation\n\n  const back = () => {\n    stop();\n    ReactDOM.render( /*#__PURE__*/React.createElement(MainView, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 42,\n        columnNumber: 5\n      }\n    }), root);\n  };\n\n  let interval;\n  let clockInterval;\n  /**\n   * runBodySegment - startpoint for the background extraction\n   */\n\n  const runBodySegment = async () => {\n    const toolBtn = document.getElementsByClassName(videoStyles.back_remove)[0];\n\n    if (render) {\n      render = false;\n      toolBtn.classList.remove(videoStyles.active);\n      canvasRef.current.style.display = 'none';\n      clearInterval(interval);\n    } else {\n      loadingRef.current.style.visibility = 'visible';\n      toolBtn.classList.add(videoStyles.active);\n      render = true;\n      const net = await bodyPix.load();\n\n      if (backVideoRef.current) {\n        backVideoRef.current.play();\n      }\n\n      canvasRef.current.style.display = 'block';\n      interval = setInterval(function () {\n        if (render) {\n          // webcamRef.current.video.style.visibility = 'hidden';\n          loadingRef.current.style.visibility = 'hidden';\n          galleryRef.current.style.filter = 'opacity(1)';\n          detect(net);\n        } else if (!render) {\n          clearInterval(interval);\n          console.log('no rendering');\n          canvasRef.current.style.display = 'none';\n        }\n      }, 29);\n    }\n  };\n  /**\n   * backMask - utility to apply the mask and compose the image using the video background\n   * @param {ImageData} image \n   * @param {ImageData} mask \n   * @returns {ImageData} image - after the mask is applied\n   */\n\n\n  const backMask = (image, mask) => {\n    // console.log(image, mask, backVideoRef.current);\n    const cv = document.createElement('canvas');\n    let imageData;\n\n    try {\n      const videoW = backVideoRef.current.videoWidth;\n      const videoH = backVideoRef.current.videoHeight;\n      cv.style.width = image.height * (videoW / videoH);\n      cv.style.height = image.height;\n      cv.width = image.height * (videoW / videoH);\n      ;\n      cv.height = image.height;\n      const ctx = cv.getContext('2d');\n      ctx.drawImage(backVideoRef.current, 0, 0, cv.width, cv.height);\n      imageData = ctx.getImageData(0, 0, image.width, image.height);\n    } catch (err) {\n      console.log(err);\n      return null;\n    } // console.log(image, mask, imageData);\n\n\n    for (let i = 0; i < image.data.length; i += 4) {\n      const vector = [mask.data[i], mask.data[i + 1], mask.data[i + 2], mask.data[i + 3]];\n\n      if (vector[0] === 255 && vector[1] === 255 && vector[2] === 255) {\n        image.data[i] = imageData.data[i];\n        image.data[i + 1] = imageData.data[i + 1];\n        image.data[i + 2] = imageData.data[i + 2];\n        image.data[i + 3] = imageData.data[i + 3];\n      }\n    }\n\n    return image;\n  };\n  /**\n   * detect - prediction for each WebCam frame\n   * @param {TensorFlowNet} net \n   */\n\n\n  const detect = async net => {\n    if (typeof webcamRef.current !== \"undefined\" && webcamRef.current !== null && webcamRef.current.video.readyState === 4) {\n      const videoTrack = webcamRef.current.stream.getVideoTracks()[0];\n      const video = webcamRef.current.video;\n      backVideoRef.current.width = video.videoWidth;\n      backVideoRef.current.height = video.videoHeight;\n      videoTrack.applyConstraints(videoConstraints);\n      const videoHeight = video.videoHeight;\n      const videoWidth = video.videoWidth;\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight;\n      canvasRef.current.width = videoWidth;\n      canvasRef.current.height = videoHeight;\n      const outStride = 16;\n      const segThreshold = 0.5;\n      const cv = document.createElement('canvas');\n      cv.style.width = videoWidth;\n      cv.style.height = videoHeight;\n      cv.width = videoWidth;\n      cv.height = videoHeight;\n      const ctx = cv.getContext('2d');\n      ctx.drawImage(video, 0, 0, cv.width, cv.height);\n      const imageData = ctx.getImageData(0, 0, cv.width, cv.height);\n      const person = await net.segmentPersonParts(video, outStride, segThreshold);\n      const coloredPart = bodyPix.toColoredPartMask(person);\n      const back = backMask(imageData, coloredPart);\n\n      if (!back) {\n        console.log('no segmentation data');\n        const ctx2 = canvasRef.current.getContext('2d');\n        ctx2.putImageData(imageData, 0, 0);\n\n        if (recording) {\n          recordedframes.push(ctx.canvas.toDataURL());\n        }\n      } else {\n        const ctx2 = canvasRef.current.getContext('2d');\n        ctx2.putImageData(back, 0, 0);\n\n        if (recording) {\n          recordedframes.push(ctx2.canvas.toDataURL());\n        }\n      }\n    }\n  };\n  /**\n   * stop - Stop each streaming Track and sets render as false to stop detection\n   */\n\n\n  const stopDetection = () => {\n    render = false;\n  };\n\n  const stop = () => {\n    render = false;\n    backVideoRef.current.pause();\n    const tracks = webcamRef.current.stream.getTracks(); // console.log(tracks);\n\n    for (const track of tracks) {\n      track.stop();\n    }\n  };\n\n  const checkVideoTrack = () => {};\n\n  let recordedChuncks = [];\n\n  const recordAudio = function () {\n    const options = {\n      mimeType: 'vide0/webm;codecs=vp9'\n    };\n    recordedChuncks = [];\n    const downloadLink = document.createElement('a');\n    const mediaRecorder = new mediaRecorder(webcamRef.current.stream, options);\n    mediaRecorder.addEventListener('dataavailable', function (e) {\n      if (e.data.size > 0) {\n        recordedChuncks.push(e.data);\n      }\n\n      if (!recording) {\n        mediaRecorder.stop();\n      }\n    });\n    mediaRecorder.addEventListener('stop', function () {\n      downloadLink.href = URL.createObjectURL(new Blob(recordedChuncks));\n      downloadLink.download = 'voice.wav';\n    });\n    mediaRecorder.start();\n  };\n\n  const activeClock = function () {\n    const clock = document.getElementsByClassName(videoStyles.record_time)[0];\n    const timeTXT = clock.querySelector('h1');\n    let minutes = 0;\n    let seconds = 0;\n    recordAudio();\n    clockInterval = setInterval(function () {\n      let timeStr = ``;\n\n      if (minutes < 10) {\n        timeStr += '0' + minutes;\n      } else {\n        timeStr += minutes;\n      }\n\n      timeStr += ':';\n\n      if (seconds < 10) {\n        timeStr += '0' + seconds;\n      } else {\n        timeStr += seconds;\n      }\n\n      if (recording) {\n        timeTXT.innerHTML = timeStr;\n        seconds++;\n\n        if (seconds > 59) {\n          seconds = 0;\n          minutes++;\n        }\n      } else {\n        clearInterval(clockInterval);\n      }\n    }, 1000);\n  };\n\n  let int;\n\n  const record = () => {\n    const triggerView = triggerRef.current;\n    console.log(triggerRef.current.querySelector('h1'));\n\n    if (!recording && !recPressed) {\n      recPressed = true;\n      recordedframes = [];\n      const clock = document.getElementsByClassName(videoStyles.record_time)[0];\n      const timeTXT = clock.querySelector('h1');\n      timeTXT.innerHTML = '00:00';\n      const recButton = document.getElementsByClassName(videoStyles.recordBtn)[0];\n      recButton.className = videoStyles.recordingBtn;\n      console.log();\n      console.log('animation init');\n      let count = 3;\n      console.log(videoStyles.trigger_anim);\n\n      function x() {\n        triggerView.querySelector('h1').className = '';\n\n        if (count === 0) {\n          console.log('stop trigger');\n          triggerView.style.display = 'none';\n          triggerView.querySelector('h1').className = '';\n          triggerView.querySelector('h1').classList.remove(videoStyles.trigger_anim);\n          clearInterval(int);\n          recording = true;\n          activeClock();\n        } else {\n          triggerView.querySelector('h1').innerHTML = count + '!';\n          triggerView.querySelector('h1').classList.add(videoStyles.trigger_anim);\n          triggerView.style.display = 'block';\n          count--;\n        }\n      }\n\n      x();\n      int = setInterval(x, 1000);\n    } else {\n      const recButton = document.getElementsByClassName(videoStyles.recordingBtn)[0];\n      recButton.className = videoStyles.recordBtn;\n      recording = false;\n      recPressed = false;\n      clearInterval(int);\n      triggerView.style.display = 'none';\n    }\n  };\n\n  const save = function () {\n    console.log(recordedframes.length);\n  }; // runBodySegment();\n\n\n  navigator.permissions.query({\n    name: 'microphone'\n  }).then(function (result) {\n    if (result.state == 'granted') {\n      return renderView();\n    } else if (result.state == 'prompt') {} else if (result.state == 'denied') {}\n\n    result.onchange = function () {\n      return renderView();\n    };\n  });\n\n  const renderView = function () {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.container,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 310,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.loading,\n      ref: loadingRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 5\n      }\n    }, \"Loading...\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.trigger,\n      ref: triggerRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 5\n      }\n    }, \"3!\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.back,\n      onClick: () => {\n        back();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 4\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.toolsMenu,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      className: videoStyles.save,\n      onClick: () => {\n        save();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"li\", {\n      className: videoStyles.back_remove,\n      onClick: () => {\n        runBodySegment();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"li\", {\n      className: videoStyles.other,\n      onClick: () => {\n        checkVideoTrack();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 7\n      }\n    }))), /*#__PURE__*/React.createElement(Webcam, {\n      ref: webcamRef,\n      className: videoStyles.webcam,\n      videoConstraints: videoConstraints,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"canvas\", {\n      ref: canvasRef,\n      className: videoStyles.render_canvas,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 329,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"video\", {\n      ref: backVideoRef,\n      className: videoStyles.back_video,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"source\", {\n      src: backVideo,\n      type: \"video/mp4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 334,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.record_time,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 336,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 6\n      }\n    }, \"00:00\"), /*#__PURE__*/React.createElement(\"button\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 338,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.controls,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.deleteBtn,\n      onClick: () => {},\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.recordBtn,\n      onClick: () => {\n        record();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.galleryBtn,\n      onClick: () => {},\n      ref: galleryRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 6\n      }\n    })));\n  };\n}\n\nclass MainView extends React.Component {\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: menuStyles.menu,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.gallery,\n      onClick: () => {\n        this.gallery();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.creator,\n      onClick: () => {\n        this.creator();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.user,\n      onClick: () => {\n        this.user();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 5\n      }\n    }));\n  }\n\n  gallery() {}\n\n  creator() {\n    ReactDOM.render( /*#__PURE__*/React.createElement(VideoFrame, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 366,\n        columnNumber: 5\n      }\n    }), root);\n  }\n\n  user() {}\n\n}\n\nfunction App() {\n  const renderVideoCapture = () => {\n    React.render( /*#__PURE__*/React.createElement(VideoFrame, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 5\n      }\n    }), root);\n  };\n\n  return /*#__PURE__*/React.createElement(MainView, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 2\n    }\n  });\n}\n\nexport default App;","map":{"version":3,"sources":["/home/dan/Documents/sol/sol/src/App.js"],"names":["React","useRef","ReactDOM","tf","bodyPix","Webcam","menuStyles","videoStyles","backVideo","root","document","getElementById","VideoFrame","loadingRef","triggerRef","galleryRef","webcamRef","canvasRef","backVideoRef","render","recPressed","recording","currentMask","recordedframes","dimensions","window","innerWidth","innerHeight","cropedDimensions","console","log","videoConstraints","width","height","facingMode","back","stop","interval","clockInterval","runBodySegment","toolBtn","getElementsByClassName","back_remove","classList","remove","active","current","style","display","clearInterval","visibility","add","net","load","play","setInterval","filter","detect","backMask","image","mask","cv","createElement","imageData","videoW","videoWidth","videoH","videoHeight","ctx","getContext","drawImage","getImageData","err","i","data","length","vector","video","readyState","videoTrack","stream","getVideoTracks","applyConstraints","outStride","segThreshold","person","segmentPersonParts","coloredPart","toColoredPartMask","ctx2","putImageData","push","canvas","toDataURL","stopDetection","pause","tracks","getTracks","track","checkVideoTrack","recordedChuncks","recordAudio","options","mimeType","downloadLink","mediaRecorder","addEventListener","e","size","href","URL","createObjectURL","Blob","download","start","activeClock","clock","record_time","timeTXT","querySelector","minutes","seconds","timeStr","innerHTML","int","record","triggerView","recButton","recordBtn","className","recordingBtn","count","trigger_anim","x","save","navigator","permissions","query","name","then","result","state","renderView","onchange","container","loading","trigger","toolsMenu","other","webcam","render_canvas","back_video","controls","deleteBtn","galleryBtn","MainView","Component","menu","gallery","creator","user","App","renderVideoCapture"],"mappings":"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","sourcesContent":["import React, { useRef } from 'react';\nimport ReactDOM from 'react-dom'; \nimport * as tf from \"@tensorflow/tfjs\";\nimport * as bodyPix from \"@tensorflow-models/body-pix\";\nimport Webcam from \"react-webcam\";\nimport './App.css';\nimport menuStyles from './Menu.module.css';\nimport videoStyles from './VideoFrame.module.css';\nimport backVideo from './airport.mp4';\n\nconst root = document.getElementById('root');\n\nfunction VideoFrame () {\n\tconst loadingRef = useRef(null);\n\tconst triggerRef = useRef(null);\n\tconst galleryRef = useRef(null);\n\tconst webcamRef = useRef(null);\n\tconst canvasRef = useRef(null);\n\tconst backVideoRef = useRef(null);\n\tlet render = false;\n\tlet recPressed = false;\n\tlet recording = false;\n\tlet currentMask;\n\tlet recordedframes = [];\n\n\tconst dimensions = [window.innerWidth, window.innerHeight];\n\tlet cropedDimensions;\n\tconsole.log(dimensions);\n\n\tconst videoConstraints = {\n\t\twidth: dimensions[0],\n\t\theight: dimensions[1],\n\t\tfacingMode: \"user\"\n\t}\n\n\t// Navigation\n\n\tconst back = () => {\n\t\tstop();\n\t\tReactDOM.render(\n\t\t\t(\n\t\t\t\t<MainView></MainView>\n\t\t\t),\n\t\t\troot\n\t\t);\n\t}\n\tlet interval;\n\tlet clockInterval;\n\t/**\n\t * runBodySegment - startpoint for the background extraction\n\t */\n\tconst runBodySegment = async () => {\n\t\tconst toolBtn = document.getElementsByClassName(videoStyles.back_remove)[0];\n\t\tif (render) {\n\t\t\trender = false;\n\t\t\ttoolBtn.classList.remove(videoStyles.active);\n\t\t\tcanvasRef.current.style.display = 'none';\n\t\t\tclearInterval(interval);\n\t\t} else {\n\t\t\tloadingRef.current.style.visibility = 'visible';\n\t\t\ttoolBtn.classList.add(videoStyles.active);\n\t\t\trender = true;\n\t\t\tconst net = await bodyPix.load();\n\t\t\tif (backVideoRef.current) {\n\t\t\t\tbackVideoRef.current.play();\n\t\t\t}\n\t\t\tcanvasRef.current.style.display = 'block';\n\t\t\tinterval = setInterval(function(){\n\t\t\t\tif (render) {\n\t\t\t\t\t// webcamRef.current.video.style.visibility = 'hidden';\n\t\t\t\t\tloadingRef.current.style.visibility = 'hidden';\n\t\t\t\t\tgalleryRef.current.style.filter = 'opacity(1)';\n\t\t\t\t\tdetect(net);\n\t\t\t\t} else if (!render) {\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\tconsole.log('no rendering');\n\t\t\t\t\tcanvasRef.current.style.display = 'none';\n\t\t\t\t}\n\t\t\t}, 29);\n\t\t}\n\t}\n\t/**\n\t * backMask - utility to apply the mask and compose the image using the video background\n\t * @param {ImageData} image \n\t * @param {ImageData} mask \n\t * @returns {ImageData} image - after the mask is applied\n\t */\n\tconst backMask = (image, mask) => {\n\t\t// console.log(image, mask, backVideoRef.current);\n\t\tconst cv = document.createElement('canvas');\n\t\tlet imageData;\n\t\ttry {\n\t\t\tconst videoW = backVideoRef.current.videoWidth;\n\t\t\tconst videoH = backVideoRef.current.videoHeight;\n\t\t\tcv.style.width = image.height * (videoW / videoH);\n\t\t\tcv.style.height = image.height;\n\t\t\tcv.width = image.height * (videoW / videoH);;\n\t\t\tcv.height = image.height;\n\t\t\tconst ctx = cv.getContext('2d');\n\t\t\tctx.drawImage(backVideoRef.current, 0, 0, cv.width, cv.height);\n\t\t\timageData = ctx.getImageData(0, 0, image.width, image.height);\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t\treturn null;\n\t\t}\n\t\t// console.log(image, mask, imageData);\n\t\tfor (let i = 0; i < image.data.length; i+=4) {\n\t\t\tconst vector = [\n\t\t\t\tmask.data[i],\n\t\t\t\tmask.data[i + 1],\n\t\t\t\tmask.data[i + 2],\n\t\t\t\tmask.data[i + 3],\n\t\t\t]\n\t\t\tif (\n\t\t\t\t(vector[0] === 255 &&\n\t\t\t\tvector[1] === 255 &&\n\t\t\t\tvector[2] === 255)\n\t\t\t\t) {\n\t\t\t\t\timage.data[i] = imageData.data[i];\n\t\t\t\t\timage.data[i + 1] = imageData.data[i + 1];\n\t\t\t\t\timage.data[i + 2] = imageData.data[i + 2];\n\t\t\t\t\timage.data[i + 3] = imageData.data[i + 3];\n\t\t\t}\n\t\t}\n\t\treturn image;\n\t}\n\t/**\n\t * detect - prediction for each WebCam frame\n\t * @param {TensorFlowNet} net \n\t */\n\tconst detect = async (net) => {\n\t\tif (\n\t\t\ttypeof webcamRef.current !== \"undefined\" &&\n\t\t\twebcamRef.current !== null &&\n\t\t\twebcamRef.current.video.readyState === 4\n\t\t\t) {\n\t\t\t\tconst videoTrack = webcamRef.current.stream.getVideoTracks()[0];\n\t\t\t\tconst video = webcamRef.current.video;\n\t\t\t\tbackVideoRef.current.width = video.videoWidth;\n\t\t\t\tbackVideoRef.current.height = video.videoHeight;\n\t\t\t\tvideoTrack.applyConstraints(videoConstraints);\n\t\t\t\tconst videoHeight = video.videoHeight;\n\t\t\t\tconst videoWidth = video.videoWidth;\n\t\t\t\twebcamRef.current.video.width = videoWidth;\n\t\t\t\twebcamRef.current.video.height = videoHeight;\n\t\t\t\tcanvasRef.current.width = videoWidth;\n\t\t\t\tcanvasRef.current.height = videoHeight;\n\t\t\t\tconst outStride = 16;\n\t\t\t\tconst segThreshold = 0.5;\n\t\t\t\tconst cv = document.createElement('canvas');\n\t\t\t\tcv.style.width = videoWidth;\n\t\t\t\tcv.style.height = videoHeight;\n\t\t\t\tcv.width = videoWidth;\n\t\t\t\tcv.height = videoHeight;\n\t\t\t\tconst ctx = cv.getContext('2d');\n\t\t\t\tctx.drawImage(video, 0, 0, cv.width, cv.height);\n\t\t\t\tconst imageData = ctx.getImageData(0, 0, cv.width, cv.height);\n\t\t\t\tconst person = await net.segmentPersonParts(video, outStride, segThreshold);\n\t\t\t\tconst coloredPart = bodyPix.toColoredPartMask(person);\n\t\t\t\tconst back = backMask(imageData, coloredPart);\n\t\t\t\tif (!back) {\n\t\t\t\t\tconsole.log('no segmentation data');\n\t\t\t\t\tconst ctx2 = canvasRef.current.getContext('2d');\n\t\t\t\t\tctx2.putImageData(imageData, 0, 0);\n\t\t\t\t\tif (recording) {\n\t\t\t\t\t\trecordedframes.push(ctx.canvas.toDataURL());\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst ctx2 = canvasRef.current.getContext('2d');\n\t\t\t\t\tctx2.putImageData(back, 0, 0);\n\t\t\t\t\tif (recording) {\n\t\t\t\t\t\trecordedframes.push(ctx2.canvas.toDataURL());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t}\n\t/**\n\t * stop - Stop each streaming Track and sets render as false to stop detection\n\t */\n\tconst stopDetection = () => {\n\t\trender = false;\n\t}\n\tconst stop = () => {\n\t\trender = false;\n\t\tbackVideoRef.current.pause();\n\t\tconst tracks = webcamRef.current.stream.getTracks();\n\t\t// console.log(tracks);\n\t\tfor (const track of tracks) {\n\t\t\ttrack.stop();\n\t\t}\n\t}\n\tconst checkVideoTrack = () => {\n\t}\n\tlet recordedChuncks = [];\n\tconst recordAudio = function () {\n\t\tconst options = {\n\t\t\tmimeType: 'vide0/webm;codecs=vp9'\n\t\t};\n\t\trecordedChuncks = [];\n\t\tconst downloadLink = document.createElement('a');\n\t\tconst mediaRecorder = new mediaRecorder(webcamRef.current.stream, options);\n\t\tmediaRecorder.addEventListener('dataavailable', function (e) {\n\t\t\tif (e.data.size > 0) {\n\t\t\t\trecordedChuncks.push(e.data);\n\t\t\t}\n\t\t\tif (!recording) {\n\t\t\t\tmediaRecorder.stop();\n\t\t\t}\n\t\t});\n\t\tmediaRecorder.addEventListener('stop', function () {\n\t\t\tdownloadLink.href = URL.createObjectURL(new Blob(recordedChuncks));\n\t\t\tdownloadLink.download = 'voice.wav';\n\t\t});\n\t\tmediaRecorder.start();\n\t}\n\tconst activeClock = function () {\n\t\tconst clock = document.getElementsByClassName(videoStyles.record_time)[0];\n\t\tconst timeTXT = clock.querySelector('h1');\n\t\tlet minutes = 0;\n\t\tlet seconds = 0;\n\t\trecordAudio();\n\t\tclockInterval = setInterval(function () {\n\t\t\tlet timeStr = ``;\n\t\t\tif (minutes < 10) {\n\t\t\t\ttimeStr += '0' + minutes;\n\t\t\t} else {\n\t\t\t\ttimeStr += minutes;\n\t\t\t}\n\t\t\ttimeStr += ':'\n\t\t\tif (seconds < 10) {\n\t\t\t\ttimeStr += '0' + seconds;\n\t\t\t} else {\n\t\t\t\ttimeStr += seconds;\n\t\t\t}\n\t\t\tif (recording) {\n\t\t\t\ttimeTXT.innerHTML = timeStr;\n\t\t\t\tseconds++;\n\t\t\t\tif (seconds > 59) {\n\t\t\t\t\tseconds = 0;\n\t\t\t\t\tminutes++;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tclearInterval(clockInterval);\n\t\t\t}\n\t\t\t\n\t\t}, 1000);\n\t}\n\tlet int;\n\tconst record = () => {\n\t\tconst triggerView = triggerRef.current;\n\t\tconsole.log(triggerRef.current.querySelector('h1'));\n\t\tif (!recording && !recPressed) {\n\t\t\trecPressed = true;\n\t\t\trecordedframes = [];\n\t\t\tconst clock = document.getElementsByClassName(videoStyles.record_time)[0];\n\t\t\tconst timeTXT = clock.querySelector('h1');\n\t\t\ttimeTXT.innerHTML = '00:00';\n\t\t\tconst recButton = document.getElementsByClassName(videoStyles.recordBtn)[0];\n\t\t\trecButton.className = videoStyles.recordingBtn;\n\t\t\tconsole.log();\n\t\t\tconsole.log('animation init');\n\t\t\tlet count = 3;\n\t\t\tconsole.log(videoStyles.trigger_anim);\n\t\t\tfunction x(){\n\t\t\t\ttriggerView.querySelector('h1').className = '';\n\t\t\t\tif (count === 0) {\n\t\t\t\t\tconsole.log('stop trigger');\n\t\t\t\t\ttriggerView.style.display = 'none';\n\t\t\t\t\ttriggerView.querySelector('h1').className = '';\n\t\t\t\t\ttriggerView.querySelector('h1').classList.remove(videoStyles.trigger_anim);\n\t\t\t\t\tclearInterval(int);\n\t\t\t\t\trecording = true;\n\t\t\t\t\tactiveClock();\n\t\t\t\t} else {\n\t\t\t\t\ttriggerView.querySelector('h1').innerHTML = count + '!';\n\t\t\t\t\ttriggerView.querySelector('h1').classList.add(videoStyles.trigger_anim);\n\t\t\t\t\ttriggerView.style.display = 'block';\n\t\t\t\t\tcount--;\n\t\t\t\t}\n\t\t\t}\n\t\t\tx();\n\t\t\tint = setInterval(x, 1000);\n\t\t} else {\n\t\t\tconst recButton = document.getElementsByClassName(videoStyles.recordingBtn)[0];\n\t\t\trecButton.className = videoStyles.recordBtn;\n\t\t\trecording = false;\n\t\t\trecPressed = false;\n\t\t\tclearInterval(int);\n\t\t\ttriggerView.style.display = 'none';\n\t\t}\n\t}\n\tconst save = function () {\n\t\tconsole.log(recordedframes.length);\n\t}\n\t// runBodySegment();\n\tnavigator.permissions.query({name:'microphone'}).then(function(result) {\n\t\tif (result.state == 'granted') {\n\t\t\treturn renderView();\n\t\t} else if (result.state == 'prompt') {\n\t\t\n\t\t} else if (result.state == 'denied') {\n\t\t\n\t\t}\n\t\tresult.onchange = function() {\n\t\t\treturn renderView();\n\t\t};\n\t});\n\tconst renderView = function () {\n\t\treturn (\n\t\t\t<div className={ videoStyles.container }>\n\t\t\t<div className={ videoStyles.loading } ref={loadingRef}>\n\t\t\t\t<h1></h1>\n\t\t\t\t<h2>Loading...</h2>\n\t\t\t</div>\n\t\t\t<div className={ videoStyles.trigger } ref={triggerRef}>\n\t\t\t\t<h1>3!</h1>\n\t\t\t</div>\n\t\t\t<div className={ videoStyles.back } onClick={() => { back() }}></div>\n\t\t\t\t<div className={ videoStyles.toolsMenu }>\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li className={ videoStyles.save } onClick={()=>{save()}}></li>\n\t\t\t\t\t\t<li className={ videoStyles.back_remove } onClick={ ()=>{runBodySegment()} }></li>\n\t\t\t\t\t\t<li className={ videoStyles.other } onClick={ ()=> { checkVideoTrack()} }></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t<Webcam ref={webcamRef} className={ videoStyles.webcam }\n\t\t\t\t\tvideoConstraints={ videoConstraints }\n\t\t\t\t\t/>\n\t\t\t\t<canvas ref={canvasRef}\n\t\t\t\t\tclassName={ videoStyles.render_canvas }></canvas>\n\t\t\t\t<video \n\t\t\t\t\tref={ backVideoRef } className={ videoStyles.back_video }\n\t\t\t\t\t>\n\t\t\t\t\t<source src={ backVideo } type=\"video/mp4\"/>\n\t\t\t\t</video>\n\t\t\t\t<div className={ videoStyles.record_time }>\n\t\t\t\t\t<h1>00:00</h1>\n\t\t\t\t\t<button></button>\n\t\t\t\t</div>\n\t\t\t\t<div className={ videoStyles.controls }>\n\t\t\t\t\t<button className={ videoStyles.deleteBtn } onClick={()=> {} }></button>\n\t\t\t\t\t<button className={ videoStyles.recordBtn } onClick={()=> { record() }}></button>\n\t\t\t\t\t<button className={ videoStyles.galleryBtn } onClick={()=> {}} ref={galleryRef}></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nclass MainView extends React.Component {\n\trender () {\n\t\treturn (\n\t\t\t<div className={ menuStyles.menu }>\n\t\t\t\t<button className={ menuStyles.gallery } onClick={()=>{this.gallery()}}></button>\n\t\t\t\t<button className={ menuStyles.creator } onClick={()=>{this.creator()}}></button>\n\t\t\t\t<button className={ menuStyles.user } onClick={()=>{this.user()}}></button>\n\t\t\t</div>\n\t\t);\n\t}\n\tgallery () {\n\n\t}\n\tcreator () {\n\t\tReactDOM.render(\n\t\t\t(\n\t\t\t\t<VideoFrame></VideoFrame>\n\t\t\t),\n\t\t\troot\n\t\t);\n\t}\n\tuser () {\n\n\t}\n}\n\nfunction App() {\n\tconst renderVideoCapture = () => {\n\t\tReact.render(\n\t\t\t(\n\t\t\t\t<VideoFrame>\n\t\t\t\t</VideoFrame>\n\t\t\t),\n\t\t\troot\n\t\t)\n\t};\n  return (\n\t<MainView></MainView>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}