{"ast":null,"code":"var _jsxFileName = \"/home/dan/Documents/sol/sol/src/App.js\";\nimport React, { useRef } from 'react';\nimport ReactDOM, { unmountComponentAtNode } from 'react-dom';\nimport * as tf from \"@tensorflow/tfjs\";\nimport * as bodyPix from \"@tensorflow-models/body-pix\";\nimport Webcam from \"react-webcam\";\nimport './App.css';\nimport menuStyles from './Menu.module.css';\nimport videoStyles from './VideoFrame.module.css';\nimport backVideo from './airport.mp4';\nimport testVideo from './rendered.mp4';\nimport { v4 as uuidv4 } from 'uuid';\nimport { Login } from './Login.js';\nimport { time } from '@tensorflow/tfjs';\nconst framerate = 41000;\n\nclass RecorderEditor extends React.Component {\n  constructor(props) {\n    super(props); // console.log(props.data);\n\n    this.callback = props.callback;\n    this.appendClip = props.appendClip;\n    this.playing = false;\n    this.data = props.data;\n    this.currentTime = this.data.start;\n    this.duration = props.data.duration;\n    this.fps = this.data.images.length / this.duration;\n  }\n\n  componentDidMount() {\n    this.toggleControls();\n    this.setCropPositions();\n    this.play();\n  }\n\n  playAudio() {\n    let context = new AudioContext();\n    let buffer = context.createBuffer(1, this.data.audio.length, 37000);\n    let buf = buffer.getChannelData(0);\n\n    for (let i = 0; i < this.data.audio.length; i++) {\n      buf[i] = this.data.audio[i];\n    }\n\n    const source = context.createBufferSource();\n    source.buffer = buffer;\n    const streamNode = context.createMediaStreamDestination();\n    source.connect(streamNode);\n    const audio = document.querySelector('audio');\n    audio.srcObject = streamNode.stream;\n    this.audio = audio;\n    this.audioContext = source;\n    source.start(this.currentTime);\n    audio.play();\n  }\n\n  setCropPositions() {\n    const timeline = document.getElementsByClassName(videoStyles.recorded_editor_timeline)[0];\n    const width = timeline.clientWidth;\n    const sPos = Math.round(this.data.start * (width / this.duration));\n    const ePos = Math.round(this.data.end * (width / this.duration));\n    const start = timeline.querySelector('[pos=\"start\"]').parentNode;\n    const end = timeline.querySelector('[pos=\"end\"]').parentNode;\n    start.style.left = sPos + 'px';\n    end.style.left = ePos + 'px';\n    console.log(timeline, width, sPos, ePos, start, end);\n  }\n\n  getImageAtTime(second) {\n    const timeline = document.getElementsByClassName(videoStyles.recorded_editor_timeline)[0];\n    const pointer = timeline.querySelector('div');\n    const index = Math.round(second * (this.data.images.length / this.duration));\n    return index;\n  }\n\n  updateTime(evn) {\n    console.log(evn.target.tagName);\n\n    if (evn.target.tagName === 'DIV') {\n      const x = evn.clientX - 20;\n      const width = evn.target.clientWidth;\n      const newTime = x * (this.duration / width);\n\n      if (this.croped_selected) {\n        console.log('move crop dial');\n        const cropSelector = document.querySelector(`[pos=\"${this.croped_selected}\"]`).parentNode;\n        this.data[this.croped_selected] = newTime;\n        cropSelector.style.left = Math.round(x) + 'px';\n      } else {\n        this.currentTime = newTime;\n        this.setTimePoint();\n      }\n\n      console.log(this.croped_selected);\n    } else if (evn.target.tagName === 'H2') {\n      const pointer = evn.target.getAttribute('pos');\n\n      if (pointer === 'current') {\n        this.croped_selected = undefined;\n        this.cleanCropSelectors(evn.target.parentNode.parentNode);\n      } else {\n        this.cleanCropSelectors(evn.target.parentNode.parentNode);\n        this.croped_selected = evn.target.getAttribute('pos');\n        evn.target.style.backgroundColor = 'blue';\n        evn.target.parentNode.style.backgroundColor = 'blue';\n      }\n    }\n  }\n\n  setTimePoint() {\n    const currentTime = this.currentTime;\n    const timeline = document.getElementsByClassName(videoStyles.recorded_editor_timeline)[0];\n    const pointer = timeline.querySelector('div');\n    const width = timeline.clientWidth - 6;\n    const position = currentTime * (width / this.duration);\n    pointer.style.left = Math.round(position) + 'px';\n  }\n\n  cleanCropSelectors(timeline) {\n    const dials = timeline.querySelectorAll('div');\n    dials[1].style.backgroundColor = 'white';\n    dials[2].style.backgroundColor = 'white';\n    dials[1].firstChild.style.backgroundColor = 'white';\n    dials[2].firstChild.style.backgroundColor = 'white';\n  }\n\n  play() {\n    const editor = this;\n    const timeline = document.getElementsByClassName(videoStyles.recorded_editor_timeline)[0];\n    this.croped_selected = undefined;\n    this.cleanCropSelectors(timeline);\n    const player = document.getElementsByClassName(videoStyles.recorded_editor_player)[0];\n    const canvas = player.querySelector('canvas');\n    canvas.width = this.data.dimensions[0];\n    canvas.height = this.data.dimensions[1];\n    const context = canvas.getContext('2d');\n    const imageData = context.createImageData(this.data.dimensions[0], this.data.dimensions[1]); // console.log(imageData);\n    // console.log(this.data.duration);\n    // console.log(this.duration);\n\n    const data = imageData.data;\n\n    function tic() {\n      try {\n        const index = editor.getImageAtTime(editor.currentTime);\n\n        for (let i = 0; i < editor.data.images[0].length; i++) {\n          data[i] = editor.data.images[index][i];\n        }\n\n        context.putImageData(imageData, 0, 0);\n        editor.currentTime += 1000 / editor.fps / 1000;\n        const timeTxt = document.getElementsByClassName(videoStyles.recorded_editor_time)[0];\n        let currentPos = editor.duration - editor.currentTime;\n        let minutes = Math.round(currentPos / 60);\n        let seconds = Math.round(currentPos % 60);\n\n        if (minutes < 10) {\n          minutes = '0' + minutes;\n        }\n\n        if (seconds < 10) {\n          seconds = '0' + seconds;\n        }\n\n        timeTxt.innerHTML = `${minutes}:${seconds}`;\n        editor.setTimePoint();\n      } catch (err) {\n        clearInterval(editor.playInterval);\n      }\n    }\n\n    if (this.playing) {\n      // Pause\n      this.playing = false;\n      this.audio.pause();\n      this.audioContext.stop(); // this.audio.pause();\n\n      clearInterval(this.playInterval);\n      const playBtn = player.querySelectorAll('button')[1];\n      playBtn.classList.remove(videoStyles.preview_pause);\n      const index = editor.getImageAtTime(editor.currentTime);\n\n      for (let i = 0; i < editor.data.images[0].length; i++) {\n        if (index >= editor.data.images.length) {\n          // end of video\n          editor.currentTime = editor.data.start;\n          editor.audio.currentTime = editor.data.start;\n          data[i] = editor.data.images[editor.data.images.length - 1][i];\n        } else {\n          data[i] = editor.data.images[index][i];\n        }\n      }\n\n      context.putImageData(imageData, 0, 0); // this.audio.currentTime = editor.currentTime;\n    } else {\n      this.playing = true;\n      this.playAudio();\n      const playBtn = player.querySelectorAll('button')[1];\n      this.playInterval = setInterval(tic, 1000 / this.fps);\n      playBtn.classList.add(videoStyles.preview_pause);\n    }\n  }\n\n  toggleControls() {\n    const controls = document.getElementsByClassName(videoStyles.recorded_editor_player_controls)[0];\n    controls.classList.toggle(videoStyles.recorded_editor_player_visible);\n  }\n\n  save() {\n    console.log('saving clip', this.data);\n    this.appendClip(this.data, this.data.index);\n    this.close();\n  }\n\n  close() {\n    this.playing = false;\n    unmountComponentAtNode(document.getElementById('editor'));\n    this.callback();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.recorded_editor,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.close_recorded,\n      onClick: () => {\n        this.close();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.save_recorded,\n      onClick: () => {\n        this.save();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.recorded_editor_timeline,\n      onClick: evn => {\n        this.updateTime(evn);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.recorded_editor_timeline_current,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      pos: \"current\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 70\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.recorded_editor_timeline_start,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      pos: \"start\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 68\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.recorded_editor_timeline_end,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      pos: \"end\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 66\n      }\n    }))), /*#__PURE__*/React.createElement(\"audio\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.recorded_editor_player,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"canvas\", {\n      onClick: () => {\n        this.toggleControls();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"audio\", {\n      className: videoStyles.recorded_editor_player_audio,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"h1\", {\n      className: videoStyles.recorded_editor_time,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 6\n      }\n    }, \"00:00\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.recorded_editor_player_controls,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => {\n        this.play();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 7\n      }\n    }))));\n  }\n\n}\n\nconst root = document.getElementById('root');\n\nclass PreviewPlayer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.clipUrl = this.props.clipUrl;\n    this.playingPreview = false;\n  }\n\n  mute(evn) {\n    const videoPreview = document.getElementsByClassName(videoStyles.record_preview)[0];\n    const video = videoPreview.querySelector('video');\n    evn.target.classList.toggle(videoStyles.preview_unmuted);\n    video.muted = !video.muted;\n    console.log(video.muted);\n  }\n\n  updatePreviewTime(evn) {\n    const previewer = this;\n    const videoPreview = document.getElementsByClassName(videoStyles.record_preview)[0];\n    this.video.pause();\n    const timeline = videoPreview.getElementsByClassName(videoStyles.preview_timeline)[0];\n    const timepoint = timeline.querySelector('h2');\n    const total = this.video.duration;\n    const width = timeline.clientWidth;\n    let time = (evn.clientX - 12) * (total / width);\n    this.video.currentTime = Number(time.toFixed(4));\n    this.placeTimePreviewPointer();\n\n    this.video.onseeked = function () {\n      if (previewer.playingPreview) {\n        previewer.playingPreview = false;\n        const playBtn = document.getElementsByClassName(videoStyles.preview_play)[0]; // console.log(previewer.video.currentTime);\n\n        previewer.playPreview({\n          target: playBtn\n        });\n      }\n    };\n  }\n\n  placeTimePreviewPointer() {\n    const videoPreview = document.getElementsByClassName(videoStyles.record_preview)[0];\n    const video = videoPreview.querySelector('video');\n    const timeline = videoPreview.getElementsByClassName(videoStyles.preview_timeline)[0];\n    const timepoint = timeline.querySelector('h2');\n    let currentPos = video.currentTime;\n    const total = video.duration;\n    const width = timeline.clientWidth;\n    const position = Math.round(currentPos * (width / total));\n    timepoint.style.marginLeft = position - 10 + 'px';\n    const timeTxt = document.getElementsByClassName(videoStyles.preview_time)[0];\n    currentPos = total - currentPos;\n    let minutes = Math.round(currentPos / 60);\n    let seconds = Math.round(currentPos % 60);\n\n    if (minutes < 10) {\n      minutes = '0' + minutes;\n    }\n\n    if (seconds < 10) {\n      seconds = '0' + seconds;\n    }\n\n    timeTxt.innerHTML = `${minutes}:${seconds}`; // // console.log(video.currentTime);\n  }\n\n  playPreview(evn) {\n    const previewer = this;\n    evn.target.style.opacity = 1; // // console.log('preview');\n\n    if (!this.playingPreview) {\n      setTimeout(() => {\n        try {\n          const playBtn = document.getElementsByClassName(videoStyles.preview_play)[0];\n          playBtn.style.opacity = 0;\n        } catch (err) {\n          console.log(err);\n        }\n      }, 1200);\n      this.playingPreview = true; // video.load();\n\n      previewer.video.play(); // // console.log(video.duration, video.played, video.buffered);\n\n      previewer.video.addEventListener('timeupdate', this.placeTimePreviewPointer);\n      evn.target.classList.add(videoStyles.preview_pause);\n      this.placeTimePreviewPointer();\n    } else {\n      evn.target.classList.remove(videoStyles.preview_pause);\n      this.playingPreview = false;\n      previewer.video.pause();\n      previewer.video.removeEventListener('timeupdate', this.placeTimePreviewPointer);\n    }\n  }\n\n  componentDidMount() {\n    const videoPreview = document.getElementsByClassName(videoStyles.record_preview)[0];\n    const video = videoPreview.querySelector('video');\n    this.video = video;\n    this.video.load(); // video.play();\n    // this.playingPreview = true;\n\n    const playBtn = document.getElementsByClassName(videoStyles.preview_play)[0];\n    this.playPreview({\n      target: playBtn\n    });\n    const player = this;\n\n    this.video.onended = function (evn) {\n      console.log('ended');\n      player.playingPreview = false;\n      playBtn.classList.remove(videoStyles.preview_pause);\n      video.currentTime = 0;\n    }; // playBtn.classList.add(videoStyles.preview_pause);\n    // video.addEventListener('timeupdate', this.placeTimePreviewPointer);\n\n  }\n\n  save() {\n    this.close();\n  }\n\n  close() {\n    const previewer = this;\n    unmountComponentAtNode(document.getElementById('preview'));\n    previewer.video.removeEventListener('timeupdate', this.placeTimePreviewPointer);\n  }\n\n  render() {\n    let clipUrl = this.clipUrl;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.record_preview,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.preview_navigation,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 357,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.preview_nav_back,\n      onClick: evn => {\n        this.close();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 8\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.preview_nav_delete,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 362,\n        columnNumber: 8\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 364,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.preview_nav_save,\n      onClick: evn => {\n        this.save();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 8\n      }\n    }))), /*#__PURE__*/React.createElement(\"video\", {\n      muted: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"source\", {\n      type: \"video/mp4\",\n      src: clipUrl,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 370,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.preview_controls,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 373,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.preview_back,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.preview_play,\n      onClick: evn => {\n        this.playPreview(evn);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 375,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.preview_ford,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 376,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.preview_muted,\n      onClick: evn => {\n        this.mute(evn);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"h1\", {\n      className: videoStyles.preview_time,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378,\n        columnNumber: 7\n      }\n    }, \"00:00\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.preview_timeline,\n      onClick: evn => {\n        this.updatePreviewTime(evn);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 8\n      }\n    }))));\n  }\n\n}\n\nfunction VideoFrame() {\n  const loadingRef = useRef(null);\n  const triggerRef = useRef(null);\n  const galleryRef = useRef(null);\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const backVideoRef = useRef(null);\n  const clips = [];\n  let render = false;\n  let recPressed = false;\n  let recording = false;\n  let currentMask;\n  let recordedframes = [];\n  const dimensions = [window.innerWidth, window.innerHeight];\n  let cropedDimensions; // console.log(dimensions);\n\n  const videoConstraints = {\n    width: dimensions[0],\n    height: dimensions[1],\n    facingMode: \"user\"\n  }; // Navigation\n\n  const back = () => {\n    stop();\n    ReactDOM.render( /*#__PURE__*/React.createElement(MainView, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 420,\n        columnNumber: 5\n      }\n    }), root);\n  };\n\n  let interval;\n  let clockInterval;\n  /**\n   * runBodySegment - startpoint for the background extraction\n   */\n\n  const runBodySegment = async () => {\n    const toolBtn = document.getElementsByClassName(videoStyles.back_remove)[0];\n\n    if (render) {\n      render = false;\n      toolBtn.classList.remove(videoStyles.active);\n      canvasRef.current.style.display = 'none';\n      clearInterval(interval);\n    } else {\n      loadingRef.current.style.visibility = 'visible';\n      toolBtn.classList.add(videoStyles.active);\n      render = true;\n      const net = await bodyPix.load();\n\n      if (backVideoRef.current) {\n        backVideoRef.current.play();\n      }\n\n      canvasRef.current.style.display = 'block';\n      interval = setInterval(async function () {\n        if (render) {\n          // webcamRef.current.video.style.visibility = 'hidden';\n          loadingRef.current.style.visibility = 'hidden';\n          galleryRef.current.style.filter = 'opacity(1)';\n          detect(net);\n        } else if (!render) {\n          clearInterval(interval); // console.log('no rendering');\n\n          canvasRef.current.style.display = 'none';\n        }\n      }, 29);\n    }\n  };\n  /**\n   * backMask - utility to apply the mask and compose the image using the video background\n   * @param {ImageData} image \n   * @param {ImageData} mask \n   * @returns {ImageData} image - after the mask is applied\n   */\n\n\n  const backMask = (image, mask) => {\n    // // console.log(image, mask, backVideoRef.current);\n    const cv = document.createElement('canvas');\n    let imageData;\n\n    try {\n      const videoW = backVideoRef.current.videoWidth;\n      const videoH = backVideoRef.current.videoHeight;\n      cv.style.width = image.height * (videoW / videoH);\n      cv.style.height = image.height;\n      cv.width = image.height * (videoW / videoH);\n      ;\n      cv.height = image.height;\n      const ctx = cv.getContext('2d');\n      ctx.drawImage(backVideoRef.current, 0, 0, cv.width, cv.height);\n      imageData = ctx.getImageData(0, 0, image.width, image.height);\n    } catch (err) {\n      // console.log(err);\n      return null;\n    } // // console.log(image, mask, imageData);\n\n\n    for (let i = 0; i < image.data.length; i += 4) {\n      const vector = [mask.data[i], mask.data[i + 1], mask.data[i + 2], mask.data[i + 3]];\n\n      if (vector[0] === 255 && vector[1] === 255 && vector[2] === 255) {\n        image.data[i] = imageData.data[i];\n        image.data[i + 1] = imageData.data[i + 1];\n        image.data[i + 2] = imageData.data[i + 2];\n        image.data[i + 3] = imageData.data[i + 3];\n      }\n    }\n\n    return image;\n  };\n  /**\n   * detect - prediction for each WebCam frame\n   * @param {TensorFlowNet} net \n   */\n\n\n  const detect = async net => {\n    if (typeof webcamRef.current !== \"undefined\" && webcamRef.current !== null && webcamRef.current.video.readyState === 4) {\n      const videoTrack = webcamRef.current.stream.getVideoTracks()[0];\n      const video = webcamRef.current.video;\n      backVideoRef.current.width = video.videoWidth;\n      backVideoRef.current.height = video.videoHeight;\n      cropedDimensions = [video.videoWidth, video.videoHeight];\n      videoTrack.applyConstraints(videoConstraints);\n      const videoHeight = video.videoHeight;\n      const videoWidth = video.videoWidth;\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight;\n      canvasRef.current.width = videoWidth;\n      canvasRef.current.height = videoHeight;\n      const outStride = 16;\n      const segThreshold = 0.5;\n      const cv = document.createElement('canvas');\n      cv.style.width = videoWidth;\n      cv.style.height = videoHeight;\n      cv.width = videoWidth;\n      cv.height = videoHeight;\n      const ctx = cv.getContext('2d');\n      ctx.drawImage(video, 0, 0, cv.width, cv.height);\n      const imageData = ctx.getImageData(0, 0, cv.width, cv.height);\n      const person = await net.segmentPersonParts(video, outStride, segThreshold);\n      const coloredPart = bodyPix.toColoredPartMask(person);\n      const back = backMask(imageData, coloredPart);\n\n      if (!back) {\n        // console.log('no segmentation data');\n        const ctx2 = canvasRef.current.getContext('2d');\n        ctx2.putImageData(imageData, 0, 0);\n\n        if (recording) {\n          recordedframes.push(Array.from(imageData.data));\n        }\n      } else {\n        const ctx2 = canvasRef.current.getContext('2d');\n        ctx2.putImageData(back, 0, 0);\n\n        if (recording) {\n          // // console.log(back.width, back.height);\n          recordedframes.push(Array.from(back.data));\n        }\n      }\n    }\n  };\n  /**\n   * stop - Stop each streaming Track and sets render as false to stop detection\n   */\n\n\n  const stopDetection = () => {\n    render = false;\n  };\n\n  const stop = () => {\n    render = false;\n    backVideoRef.current.pause();\n    const tracks = webcamRef.current.stream.getTracks(); // // console.log(tracks);\n\n    for (const track of tracks) {\n      track.stop();\n    }\n  };\n\n  const checkVideoTrack = () => {};\n\n  let recordedChuncks = [];\n  let audioStream;\n  const chunkl = 256 * 64;\n\n  const recordAudio = function () {\n    audioStream = webcamRef.current.stream;\n    const options = {\n      mimeType: 'audio/webm'\n    };\n    recordedChuncks = []; // console.log(audioStream);\n\n    var context = new AudioContext({\n      sampleRate: framerate\n    });\n    var source = context.createMediaStreamSource(audioStream);\n    var processor = context.createScriptProcessor(chunkl, 1, 1);\n    source.connect(processor);\n    processor.connect(context.destination);\n\n    const event = async function (e) {\n      if (recording) {\n        // // console.log(e.inputBuffer);\n        recordedChuncks.push(...e.inputBuffer.getChannelData(0));\n      } else {\n        processor.onaudioprocess = null;\n      }\n    };\n\n    processor.onaudioprocess = event;\n  };\n\n  let minutes = 0;\n  let seconds = 0;\n  let mill = 0;\n\n  const activeClock = function () {\n    minutes = 0;\n    seconds = 0;\n    const clock = document.getElementsByClassName(videoStyles.record_time)[0];\n    const timeTXT = clock.querySelector('h1');\n    const timeButton = clock.querySelector('button');\n    timeButton.classList.add(videoStyles.recording);\n\n    const tic = function () {\n      if (recording) {\n        let timeStr = ``; // modify the time\n\n        seconds++;\n\n        if (seconds > 59) {\n          seconds = 0;\n          minutes++;\n        } // add padding for the minutes and seconds\n\n\n        if (minutes < 10) {\n          timeStr += '0' + minutes;\n        } else {\n          timeStr += minutes;\n        }\n\n        timeStr += ':';\n\n        if (seconds < 10) {\n          timeStr += '0' + seconds;\n        } else {\n          timeStr += seconds;\n        } // draw the time in browser\n\n\n        timeTXT.innerHTML = timeStr;\n      } else {\n        timeButton.classList.remove(videoStyles.recording);\n        clearInterval(clockInterval);\n      }\n    };\n\n    clockInterval = setInterval(tic, 1000);\n  };\n\n  let int;\n  let context = this;\n\n  const record = () => {\n    const triggerView = triggerRef.current; // console.log(triggerRef.current.querySelector('h1'));\n\n    if (!recording && !recPressed) {\n      recPressed = true;\n      recordedframes = [];\n      const clock = document.getElementsByClassName(videoStyles.record_time)[0];\n      const timeTXT = clock.querySelector('h1');\n      timeTXT.innerHTML = '00:00';\n      const recButton = document.getElementsByClassName(videoStyles.recordBtn)[0];\n      recButton.className = videoStyles.recordingBtn; // console.log();\n      // console.log('animation init');\n\n      let count = 3; // console.log(videoStyles.trigger_anim);\n\n      function x() {\n        triggerView.querySelector('h1').className = '';\n\n        if (count === 0) {\n          // console.log('stop trigger');\n          triggerView.style.display = 'none';\n          triggerView.querySelector('h1').className = '';\n          triggerView.querySelector('h1').classList.remove(videoStyles.trigger_anim);\n          clearInterval(int);\n          recording = true;\n          activeClock();\n          recordAudio();\n        } else {\n          triggerView.querySelector('h1').innerHTML = count + '!';\n          triggerView.querySelector('h1').classList.add(videoStyles.trigger_anim);\n          triggerView.style.display = 'block';\n          count--;\n        }\n      }\n\n      x();\n      int = setInterval(x, 1000);\n    } else {\n      const recButton = document.getElementsByClassName(videoStyles.recordingBtn)[0];\n      recButton.className = videoStyles.recordBtn;\n      recording = false;\n      recPressed = false;\n      clearInterval(int);\n      triggerView.style.display = 'none';\n\n      if (recordedframes.length > 0) {\n        const props = {\n          images: recordedframes,\n          audio: recordedChuncks,\n          dimensions: cropedDimensions,\n          duration: recordedChuncks.length / framerate,\n          start: 0,\n          end: recordedChuncks.length / framerate\n        };\n        renderEditor(props, drawRecordedClips);\n      } else {\n        deleteRecorded();\n      }\n    }\n  };\n\n  const renderEditor = function (props, callback) {\n    render = false;\n    const toolBtn = document.getElementsByClassName(videoStyles.back_remove)[0];\n    toolBtn.classList.remove(videoStyles.active);\n    const editor = document.getElementById('editor'); // console.log(callback);\n\n    ReactDOM.render( /*#__PURE__*/React.createElement(RecorderEditor, {\n      data: props,\n      callback: callback,\n      appendClip: appendClip,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 706,\n        columnNumber: 5\n      }\n    }), editor);\n  };\n\n  const uploadClip = async function (clip) {\n    const processId = uuidv4(); // Uploading Audio fragments\n\n    let audioStartindex = Math.round(clip.start * (clip.recordedChuncks.length / clip.duration));\n    let audioEndindex = Math.round(clip.end * (clip.recordedChuncks.length / clip.duration));\n\n    for (let aIndex = audioStartindex; aIndex < audioEndindex; aIndex += chunkl) {\n      const diff = clip.recordedChuncks.length - aIndex;\n      let chunk;\n\n      if (diff < chunkl) {\n        chunk = clip.recordedChuncks.slice(aIndex, clip.recordedChuncks.length);\n      } else {\n        chunk = clip.recordedChuncks.slice(aIndex, aIndex + chunkl);\n      }\n\n      const req = await fetch(`http://127.0.0.1:3001/video/join`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': localStorage.getItem('token')\n        },\n        body: JSON.stringify({\n          id: processId,\n          type: 'audio',\n          data: chunk\n        })\n      }); // console.log(await req.json());\n    } // Uploading Video fragments\n\n\n    let videoStartindex = Math.round(clip.start * (clip.recordedframes.length / clip.duration));\n    let videoEndindex = Math.round(clip.end * (clip.recordedframes.length / clip.duration));\n\n    for (let vIndex = videoStartindex; vIndex < videoEndindex; vIndex++) {\n      let chunk;\n      chunk = Array.from(clip.recordedframes[vIndex]);\n      const req = await fetch(`http://127.0.0.1:3001/video/join`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': localStorage.getItem('token')\n        },\n        body: JSON.stringify({\n          id: processId,\n          type: 'video',\n          dimensions: clip.dimensions,\n          data: chunk\n        })\n      }); // console.log(await req.json());\n    } // Render the clip\n\n\n    const req = await fetch(`http://127.0.0.1:3001/video/join`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': localStorage.getItem('token')\n      },\n      body: JSON.stringify({\n        id: processId,\n        type: 'render',\n        time: {\n          minutes: minutes,\n          seconds: seconds\n        }\n      })\n    });\n    const res = await req.json(); // console.log(res);\n\n    return processId;\n  };\n\n  const renderVideo = async function () {\n    loadingRef.current.style.visibility = 'visible';\n    const renderedClips = []; // render each clip\n\n    for (let i = 0; i < clips.length; i++) {\n      const clipId = await uploadClip(clips[i]);\n      renderedClips.push(clipId);\n    } // Then merge all\n\n\n    const processId = uuidv4();\n    const req = await fetch(`http://127.0.0.1:3001/video/join`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': localStorage.getItem('token')\n      },\n      body: JSON.stringify({\n        id: processId,\n        type: 'merge',\n        clips: renderedClips\n      })\n    });\n    const res = await req.json(); // console.log(res);\n\n    return res.id;\n  };\n\n  const save = async function () {\n    const renderedVideoId = await renderVideo();\n    loadingRef.current.style.visibility = 'hidden';\n    openPreview(`http://127.0.0.1:3001/video/clips/${renderedVideoId}`);\n  };\n\n  const openPreview = function (url) {\n    const videoPreview = document.getElementById('preview');\n    ReactDOM.render( /*#__PURE__*/React.createElement(PreviewPlayer, {\n      clipUrl: url,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 823,\n        columnNumber: 5\n      }\n    }), videoPreview);\n  };\n\n  const lowerSize = function () {\n    return cropedDimensions[0] > cropedDimensions[1] ? cropedDimensions[1] : cropedDimensions[0];\n  };\n\n  const openClip = function (index) {\n    const props = {\n      images: clips[index].recordedframes,\n      audio: clips[index].recordedChuncks,\n      dimensions: clips[index].dimensions,\n      duration: clips[index].duration,\n      index: index,\n      start: clips[index].start,\n      end: clips[index].end\n    };\n    render = false;\n    renderEditor(props, drawRecordedClips);\n  };\n\n  const appendClip = function (data, index) {\n    const newData = {\n      recordedChuncks: data.audio,\n      recordedframes: data.images,\n      dimensions: data.dimensions,\n      duration: data.duration,\n      start: data.start,\n      end: data.end\n    };\n\n    if (index !== undefined && index !== null) {\n      newData.index = index;\n      clips[index] = newData;\n    } else {\n      clips.push(newData);\n    }\n\n    deleteRecorded();\n  };\n\n  const drawRecordedClips = function () {\n    const editor = document.getElementById('editor');\n    let clipIndex = 0;\n    const renderClips = clips.map(clip => {\n      const frame = clip.recordedframes[0];\n      const canvas = document.createElement('canvas');\n      canvas.width = cropedDimensions[0];\n      canvas.height = cropedDimensions[1];\n      const ctx = canvas.getContext('2d');\n      const imageData = ctx.createImageData(dimensions[0], dimensions[1]);\n\n      for (let i = 0; i < frame.length; i++) {\n        imageData.data[i] = frame[i];\n      }\n\n      ctx.putImageData(imageData, 0, 0);\n      const cropped = ctx.getImageData(0, cropedDimensions[1] - lowerSize(), lowerSize(), lowerSize());\n      ctx.canvas.width = lowerSize();\n      ctx.canvas.height = lowerSize();\n      ctx.putImageData(cropped, 0, 0);\n      const dataUrl = ctx.canvas.toDataURL('image/png');\n      const tmpIndex = clipIndex;\n      clipIndex++;\n      return /*#__PURE__*/React.createElement(\"li\", {\n        className: videoStyles.clip,\n        key: uuidv4(),\n        onClick: evn => {\n          openClip(tmpIndex);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 883,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        src: dataUrl,\n        alt: \"\",\n        key: uuidv4(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 885,\n          columnNumber: 6\n        }\n      }));\n    }); // console.log(renderClips);\n\n    ReactDOM.render( /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.clips,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 892,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.clips_back,\n      onClick: evn => {\n        scrollClips(evn, -20);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 893,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 894,\n        columnNumber: 6\n      }\n    }, renderClips), /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.clips_next,\n      onClick: evn => {\n        scrollClips(evn, 20);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 897,\n        columnNumber: 6\n      }\n    })), editor);\n  };\n\n  const scrollClips = function (evn, steps) {\n    const parent = evn.target.parentNode;\n    const clipList = parent.querySelector('ul');\n    let scroll = clipList.scrollLeft;\n    scroll += steps;\n    clipList.scrollLeft = scroll;\n  };\n\n  const deleteRecorded = function () {\n    recordedChuncks = [];\n    recordedframes = [];\n    const clock = document.getElementsByClassName(videoStyles.record_time)[0];\n    const timeTXT = clock.querySelector('h1');\n    timeTXT.innerHTML = '00:00';\n  }; // runBodySegment();\n\n\n  navigator.mediaDevices.getUserMedia({\n    audio: true,\n    video: false\n  }).then(function (result) {\n    audioStream = result;\n  });\n\n  const renderView = function () {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.container,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 923,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"preview\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 924,\n        columnNumber: 4\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.loading,\n      ref: loadingRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 926,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 927,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 928,\n        columnNumber: 5\n      }\n    }, \"Loading...\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.trigger,\n      ref: triggerRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 930,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 931,\n        columnNumber: 5\n      }\n    }, \"3!\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.back,\n      onClick: () => {\n        back();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 933,\n        columnNumber: 4\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.toolsMenu,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 934,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 935,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      className: videoStyles.save,\n      onClick: () => {\n        save();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 936,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"li\", {\n      className: videoStyles.back_remove,\n      onClick: () => {\n        runBodySegment();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 937,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"li\", {\n      className: videoStyles.other,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 938,\n        columnNumber: 7\n      }\n    }))), /*#__PURE__*/React.createElement(Webcam, {\n      ref: webcamRef,\n      className: videoStyles.webcam,\n      videoConstraints: videoConstraints,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 941,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"canvas\", {\n      ref: canvasRef,\n      className: videoStyles.render_canvas,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 944,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"video\", {\n      ref: backVideoRef,\n      className: videoStyles.back_video,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 946,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"source\", {\n      src: backVideo,\n      type: \"video/mp4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 949,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.record_time,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 951,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 952,\n        columnNumber: 6\n      }\n    }, \"00:00\"), /*#__PURE__*/React.createElement(\"button\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 953,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"editor\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 955,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: videoStyles.controls,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 956,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.galleryBtn,\n      onClick: () => {},\n      ref: galleryRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 958,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.recordBtn,\n      onClick: () => {\n        record();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 959,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: videoStyles.deleteBtn,\n      onClick: () => {\n        deleteRecorded();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 960,\n        columnNumber: 6\n      }\n    })));\n  };\n\n  return renderView();\n}\n\nexport class MainView extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {};\n  }\n\n  playClip(url) {\n    ReactDOM.render( /*#__PURE__*/React.createElement(PreviewPlayer, {\n      clipUrl: url,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 977,\n        columnNumber: 5\n      }\n    }), document.getElementById('preview'));\n  }\n\n  render() {\n    const videos = this.state.videos;\n    let rendered;\n    console.log(videos);\n\n    if (videos) {\n      rendered = videos.map(clip => {\n        const url = clip.src;\n        const sec = Math.round(Number(clip.duration));\n        return /*#__PURE__*/React.createElement(\"li\", {\n          className: menuStyles.gallery_clip,\n          key: uuidv4(),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 991,\n            columnNumber: 6\n          }\n        }, /*#__PURE__*/React.createElement(\"h2\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 992,\n            columnNumber: 7\n          }\n        }, sec, \" sec\"), /*#__PURE__*/React.createElement(\"video\", {\n          src: url,\n          onClick: () => {\n            this.playClip(url);\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 993,\n            columnNumber: 7\n          }\n        }));\n      });\n    }\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1000,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"preview\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1001,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"ul\", {\n      className: menuStyles.gallery_container,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1003,\n        columnNumber: 5\n      }\n    }, rendered), /*#__PURE__*/React.createElement(\"div\", {\n      className: menuStyles.menu,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1006,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.gallery,\n      onClick: () => {\n        this.gallery();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1007,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.creator,\n      onClick: () => {\n        this.creator();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1008,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: menuStyles.user,\n      onClick: () => {\n        this.user();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1009,\n        columnNumber: 6\n      }\n    })));\n  }\n\n  componentDidMount() {\n    const gallery = this;\n    fetch(`http://127.0.0.1:3001/video/clips/urls`, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': localStorage.getItem('token')\n      }\n    }).then(res => {\n      if (res.status !== 200) {\n        this.user();\n      } else {\n        return res.json();\n      }\n    }).then(json => {\n      // console.log(json);\n      const state = gallery.state;\n      state.videos = json;\n      this.setState(state);\n    });\n  }\n\n  gallery() {}\n\n  creator() {\n    ReactDOM.render( /*#__PURE__*/React.createElement(VideoFrame, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1043,\n        columnNumber: 5\n      }\n    }), root);\n  }\n\n  user() {\n    localStorage.removeItem('token');\n    window.location.reload();\n  }\n\n}\n\nfunction App() {\n  const renderVideoCapture = () => {\n    React.render( /*#__PURE__*/React.createElement(VideoFrame, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1058,\n        columnNumber: 5\n      }\n    }), root);\n  };\n\n  if (localStorage.getItem('token')) {\n    return /*#__PURE__*/React.createElement(MainView, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1066,\n        columnNumber: 4\n      }\n    });\n  } else {\n    return /*#__PURE__*/React.createElement(Login, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1070,\n        columnNumber: 4\n      }\n    });\n  }\n}\n\nexport default App;","map":{"version":3,"sources":["/home/dan/Documents/sol/sol/src/App.js"],"names":["React","useRef","ReactDOM","unmountComponentAtNode","tf","bodyPix","Webcam","menuStyles","videoStyles","backVideo","testVideo","v4","uuidv4","Login","time","framerate","RecorderEditor","Component","constructor","props","callback","appendClip","playing","data","currentTime","start","duration","fps","images","length","componentDidMount","toggleControls","setCropPositions","play","playAudio","context","AudioContext","buffer","createBuffer","audio","buf","getChannelData","i","source","createBufferSource","streamNode","createMediaStreamDestination","connect","document","querySelector","srcObject","stream","audioContext","timeline","getElementsByClassName","recorded_editor_timeline","width","clientWidth","sPos","Math","round","ePos","end","parentNode","style","left","console","log","getImageAtTime","second","pointer","index","updateTime","evn","target","tagName","x","clientX","newTime","croped_selected","cropSelector","setTimePoint","getAttribute","undefined","cleanCropSelectors","backgroundColor","position","dials","querySelectorAll","firstChild","editor","player","recorded_editor_player","canvas","dimensions","height","getContext","imageData","createImageData","tic","putImageData","timeTxt","recorded_editor_time","currentPos","minutes","seconds","innerHTML","err","clearInterval","playInterval","pause","stop","playBtn","classList","remove","preview_pause","setInterval","add","controls","recorded_editor_player_controls","toggle","recorded_editor_player_visible","save","close","getElementById","render","recorded_editor","close_recorded","save_recorded","recorded_editor_timeline_current","recorded_editor_timeline_start","recorded_editor_timeline_end","recorded_editor_player_audio","root","PreviewPlayer","clipUrl","playingPreview","mute","videoPreview","record_preview","video","preview_unmuted","muted","updatePreviewTime","previewer","preview_timeline","timepoint","total","Number","toFixed","placeTimePreviewPointer","onseeked","preview_play","playPreview","marginLeft","preview_time","opacity","setTimeout","addEventListener","removeEventListener","load","onended","preview_navigation","preview_nav_back","preview_nav_delete","preview_nav_save","preview_controls","preview_back","preview_ford","preview_muted","VideoFrame","loadingRef","triggerRef","galleryRef","webcamRef","canvasRef","backVideoRef","clips","recPressed","recording","currentMask","recordedframes","window","innerWidth","innerHeight","cropedDimensions","videoConstraints","facingMode","back","interval","clockInterval","runBodySegment","toolBtn","back_remove","active","current","display","visibility","net","filter","detect","backMask","image","mask","cv","createElement","videoW","videoWidth","videoH","videoHeight","ctx","drawImage","getImageData","vector","readyState","videoTrack","getVideoTracks","applyConstraints","outStride","segThreshold","person","segmentPersonParts","coloredPart","toColoredPartMask","ctx2","push","Array","from","stopDetection","tracks","getTracks","track","checkVideoTrack","recordedChuncks","audioStream","chunkl","recordAudio","options","mimeType","sampleRate","createMediaStreamSource","processor","createScriptProcessor","destination","event","e","inputBuffer","onaudioprocess","mill","activeClock","clock","record_time","timeTXT","timeButton","timeStr","int","record","triggerView","recButton","recordBtn","className","recordingBtn","count","trigger_anim","renderEditor","drawRecordedClips","deleteRecorded","uploadClip","clip","processId","audioStartindex","audioEndindex","aIndex","diff","chunk","slice","req","fetch","method","headers","localStorage","getItem","body","JSON","stringify","id","type","videoStartindex","videoEndindex","vIndex","res","json","renderVideo","renderedClips","clipId","renderedVideoId","openPreview","url","lowerSize","openClip","newData","clipIndex","renderClips","map","frame","cropped","dataUrl","toDataURL","tmpIndex","clips_back","scrollClips","clips_next","steps","parent","clipList","scroll","scrollLeft","navigator","mediaDevices","getUserMedia","then","result","renderView","container","loading","trigger","toolsMenu","other","webcam","render_canvas","back_video","galleryBtn","deleteBtn","MainView","state","playClip","videos","rendered","src","sec","gallery_clip","gallery_container","menu","gallery","creator","user","status","setState","removeItem","location","reload","App","renderVideoCapture"],"mappings":"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","sourcesContent":["import React, { useRef } from 'react';\nimport ReactDOM, { unmountComponentAtNode } from 'react-dom'; \nimport * as tf from \"@tensorflow/tfjs\";\nimport * as bodyPix from \"@tensorflow-models/body-pix\";\nimport Webcam from \"react-webcam\";\nimport './App.css';\nimport menuStyles from './Menu.module.css';\nimport videoStyles from './VideoFrame.module.css';\nimport backVideo from './airport.mp4';\nimport testVideo from './rendered.mp4';\nimport { v4 as uuidv4 } from 'uuid';\nimport { Login } from './Login.js'\nimport { time } from '@tensorflow/tfjs';\n\nconst framerate = 41000;\n\nclass RecorderEditor extends React.Component {\n\tconstructor (props) {\n\t\tsuper(props);\n\t\t// console.log(props.data);\n\t\tthis.callback = props.callback;\n\t\tthis.appendClip = props.appendClip;\n\t\tthis.playing = false;\n\t\tthis.data = props.data;\n\t\tthis.currentTime = this.data.start;\n\t\tthis.duration = props.data.duration;\n\t\tthis.fps = this.data.images.length / this.duration;\n\t}\n\tcomponentDidMount () {\n\t\tthis.toggleControls();\n\t\tthis.setCropPositions();\n\t\tthis.play();\n\t}\n\tplayAudio () {\n\t\tlet context = new AudioContext();\n\t\tlet buffer = context.createBuffer(1, this.data.audio.length, 37000);\n\t\tlet buf = buffer.getChannelData(0);\n\t\tfor (let i = 0; i < this.data.audio.length; i++) {\n\t\t\tbuf[i] = this.data.audio[i];\n\t\t}\n\t\tconst source = context.createBufferSource();\n\t\tsource.buffer = buffer;\n\t\tconst streamNode = context.createMediaStreamDestination();\n\t\tsource.connect(streamNode);\n\t\tconst audio = document.querySelector('audio');\n\t\taudio.srcObject = streamNode.stream;\n\t\tthis.audio = audio;\n\t\tthis.audioContext = source;\n\t\tsource.start(this.currentTime);\n\t\taudio.play();\n\t}\n\tsetCropPositions () {\n\t\tconst timeline = document.getElementsByClassName(videoStyles.recorded_editor_timeline)[0];\n\t\tconst width = timeline.clientWidth;\n\t\tconst sPos = Math.round(this.data.start * (width / this.duration));\n\t\tconst ePos = Math.round(this.data.end * (width / this.duration));\n\t\tconst start = timeline.querySelector('[pos=\"start\"]').parentNode;\n\t\tconst end = timeline.querySelector('[pos=\"end\"]').parentNode;\n\t\tstart.style.left = sPos + 'px';\n\t\tend.style.left = ePos + 'px';\n\t\tconsole.log(timeline, width, sPos, ePos, start, end);\n\t}\n\tgetImageAtTime(second) {\n\t\tconst timeline = document.getElementsByClassName(videoStyles.recorded_editor_timeline)[0];\n\t\tconst pointer = timeline.querySelector('div');\n\t\tconst index = Math.round(second * (this.data.images.length / this.duration));\n\t\treturn index;\n\t}\n\tupdateTime (evn) {\n\t\tconsole.log(evn.target.tagName);\n\t\tif (evn.target.tagName === 'DIV') {\n\t\t\tconst x = evn.clientX - 20;\n\t\t\tconst width = evn.target.clientWidth;\n\t\t\tconst newTime = x * (this.duration / width);\n\t\t\tif (this.croped_selected) {\n\t\t\t\tconsole.log('move crop dial');\n\t\t\t\tconst cropSelector = document.querySelector(`[pos=\"${this.croped_selected}\"]`).parentNode;\n\t\t\t\tthis.data[this.croped_selected] = newTime;\n\t\t\t\tcropSelector.style.left = Math.round(x) + 'px';\n\t\t\t} else {\n\t\t\t\tthis.currentTime = newTime;\n\t\t\t\tthis.setTimePoint();\n\t\t\t}\n\t\t\tconsole.log(this.croped_selected);\n\t\t} else if (evn.target.tagName === 'H2') {\n\t\t\tconst pointer = evn.target.getAttribute('pos');\n\t\t\tif (pointer === 'current') {\n\t\t\t\tthis.croped_selected = undefined;\n\t\t\t\tthis.cleanCropSelectors(evn.target.parentNode.parentNode);\n\t\t\t} else {\n\t\t\t\tthis.cleanCropSelectors(evn.target.parentNode.parentNode);\n\t\t\t\tthis.croped_selected = evn.target.getAttribute('pos');\n\t\t\t\tevn.target.style.backgroundColor = 'blue';\n\t\t\t\tevn.target.parentNode.style.backgroundColor = 'blue';\n\t\t\t}\n\t\t}\n\t}\n\tsetTimePoint () {\n\t\tconst currentTime = this.currentTime;\n\t\tconst timeline = document.getElementsByClassName(videoStyles.recorded_editor_timeline)[0];\n\t\tconst pointer = timeline.querySelector('div');\n\t\tconst width = timeline.clientWidth - 6;\n\t\tconst position = currentTime * (width / this.duration);\n\t\tpointer.style.left = Math.round(position) + 'px';\n\t}\n\tcleanCropSelectors (timeline) {\n\t\tconst dials = timeline.querySelectorAll('div');\n\t\tdials[1].style.backgroundColor = 'white';\n\t\tdials[2].style.backgroundColor = 'white';\n\t\tdials[1].firstChild.style.backgroundColor = 'white';\n\t\tdials[2].firstChild.style.backgroundColor = 'white';\n\t}\n\tplay () {\n\t\tconst editor = this;\n\t\tconst timeline = document.getElementsByClassName(videoStyles.recorded_editor_timeline)[0];\n\t\tthis.croped_selected = undefined;\n\t\tthis.cleanCropSelectors(timeline);\n\t\tconst player = document.getElementsByClassName(videoStyles.recorded_editor_player)[0];\n\t\tconst canvas = player.querySelector('canvas');\n\t\tcanvas.width = this.data.dimensions[0];\n\t\tcanvas.height = this.data.dimensions[1];\n\t\tconst context = canvas.getContext('2d');\n\t\tconst imageData = context.createImageData(this.data.dimensions[0], this.data.dimensions[1]);\n\t\t// console.log(imageData);\n\t\t// console.log(this.data.duration);\n\t\t// console.log(this.duration);\n\t\tconst data = imageData.data;\n\t\tfunction tic () {\n\t\t\ttry {\n\t\t\t\tconst index = editor.getImageAtTime(editor.currentTime);\n\t\t\t\tfor (let i = 0; i < editor.data.images[0].length; i++) {\n\t\t\t\t\tdata[i]= editor.data.images[index][i];\n\t\t\t\t}\n\t\t\t\tcontext.putImageData(imageData, 0, 0);\n\t\t\t\teditor.currentTime += (1000 / editor.fps) / 1000;\n\t\t\t\tconst timeTxt = document.getElementsByClassName(videoStyles.recorded_editor_time)[0];\n\t\t\t\tlet currentPos = editor.duration - editor.currentTime;\n\t\t\t\tlet minutes = Math.round(currentPos / 60);\n\t\t\t\tlet seconds = Math.round(currentPos % 60);\n\t\t\t\tif (minutes < 10) {\n\t\t\t\t\tminutes = '0' + minutes;\n\t\t\t\t}\n\t\t\t\tif (seconds < 10) {\n\t\t\t\t\tseconds = '0' + seconds;\n\t\t\t\t}\n\t\t\t\ttimeTxt.innerHTML = `${minutes}:${seconds}`;\n\t\t\t\teditor.setTimePoint();\n\t\t\t} catch (err) {\n\t\t\t\tclearInterval(editor.playInterval);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (this.playing) {\n\t\t\t// Pause\n\t\t\tthis.playing = false;\n\t\t\tthis.audio.pause();\n\t\t\tthis.audioContext.stop();\n\t\t\t// this.audio.pause();\n\t\t\tclearInterval(this.playInterval);\n\t\t\tconst playBtn = player.querySelectorAll('button')[1];\n\t\t\tplayBtn.classList.remove(videoStyles.preview_pause);\n\t\t\tconst index = editor.getImageAtTime(editor.currentTime);\n\t\t\tfor (let i = 0; i < editor.data.images[0].length; i++) {\n\t\t\t\tif (index >= editor.data.images.length) {\n\t\t\t\t\t// end of video\n\t\t\t\t\teditor.currentTime = editor.data.start;\n\t\t\t\t\teditor.audio.currentTime = editor.data.start;\n\t\t\t\t\tdata[i]= editor.data.images[editor.data.images.length - 1][i];\n\t\t\t\t} else {\n\t\t\t\t\tdata[i]= editor.data.images[index][i];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\tcontext.putImageData(imageData, 0, 0);\n\t\t\t// this.audio.currentTime = editor.currentTime;\n\t\t} else {\n\t\t\tthis.playing = true;\n\t\t\tthis.playAudio();\n\t\t\tconst playBtn = player.querySelectorAll('button')[1];\n\t\t\tthis.playInterval = setInterval(tic, 1000 / this.fps);\n\t\t\tplayBtn.classList.add(videoStyles.preview_pause);\n\t\t}\n\t}\n\ttoggleControls () {\n\t\tconst controls = document.getElementsByClassName(videoStyles.recorded_editor_player_controls)[0];\n\t\tcontrols.classList.toggle(videoStyles.recorded_editor_player_visible);\n\t}\n\tsave () {\n\t\tconsole.log('saving clip', this.data);\n\t\tthis.appendClip(this.data, this.data.index);\n\t\tthis.close();\n\t}\n\tclose () {\n\t\tthis.playing = false;\n\t\tunmountComponentAtNode(document.getElementById('editor'));\n\t\tthis.callback();\n\t}\n\trender () {\n\t\treturn (\n\t\t\t<div className={ videoStyles.recorded_editor }>\n\t\t\t\t\n\t\t\t\t<button className={ videoStyles.close_recorded } onClick={ ()=>{ this.close() }}></button>\n\t\t\t\t<button className={ videoStyles.save_recorded } onClick={ ()=>{ this.save() }}></button>\n\t\t\t\t<ul>\n\t\t\t\t\t<li></li>\n\t\t\t\t\t<li></li>\n\t\t\t\t\t<li></li>\n\t\t\t\t\t<li></li>\n\t\t\t\t</ul>\n\t\t\t\t<div className={ videoStyles.recorded_editor_timeline } onClick={ (evn)=>{ this.updateTime(evn) } }>\n\t\t\t\t\t<div className={ videoStyles.recorded_editor_timeline_current }><h2 pos=\"current\"></h2></div>\n\t\t\t\t\t<div className={ videoStyles.recorded_editor_timeline_start }><h2 pos=\"start\"></h2></div>\n\t\t\t\t\t<div className={ videoStyles.recorded_editor_timeline_end }><h2 pos=\"end\"></h2></div>\n\t\t\t\t</div>\n\t\t\t\t<audio></audio>\n\t\t\t\t<div className={ videoStyles.recorded_editor_player }>\n\t\t\t\t\t<canvas onClick={ ()=>{ this.toggleControls() } }></canvas>\n\t\t\t\t\t<audio className={ videoStyles.recorded_editor_player_audio }></audio>\n\t\t\t\t\t<h1 className={ videoStyles.recorded_editor_time }>00:00</h1>\n\t\t\t\t\t<div className={ videoStyles.recorded_editor_player_controls }>\n\t\t\t\t\t\t<button></button>\n\t\t\t\t\t\t<button onClick={ ()=> { this.play() } }></button>\n\t\t\t\t\t\t<button></button>\n\t\t\t\t\t\t<h1></h1>\n\t\t\t\t\t\t<button></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\n\nconst root = document.getElementById('root');\nclass PreviewPlayer extends React.Component {\n\tconstructor (props) {\n\t\tsuper(props);\n\t\tthis.clipUrl = this.props.clipUrl;\n\t\tthis.playingPreview = false;\n\t}\n\tmute (evn) {\n\t\tconst videoPreview = document.getElementsByClassName(videoStyles.record_preview)[0];\n\t\tconst video = videoPreview.querySelector('video');\n\t\tevn.target.classList.toggle(videoStyles.preview_unmuted);\n\n\t\tvideo.muted = (!video.muted)\n\t\tconsole.log(video.muted);\n\t}\n\tupdatePreviewTime (evn) {\n\t\tconst previewer = this;\n\t\tconst videoPreview = document.getElementsByClassName(videoStyles.record_preview)[0];\n\t\tthis.video.pause();\n\t\tconst timeline = videoPreview.getElementsByClassName(videoStyles.preview_timeline)[0];\n\t\tconst timepoint = timeline.querySelector('h2');\n\t\tconst total = this.video.duration;\n\t\tconst width = timeline.clientWidth;\n\t\tlet time = (evn.clientX - 12) * (total / width);\n\t\tthis.video.currentTime = Number(time.toFixed(4));\n\t\tthis.placeTimePreviewPointer();\n\t\tthis.video.onseeked = function () {\n\t\t\tif (previewer.playingPreview) {\n\t\t\t\tpreviewer.playingPreview = false;\n\t\t\t\tconst playBtn = document.getElementsByClassName(videoStyles.preview_play)[0];\n\t\t\t\t// console.log(previewer.video.currentTime);\n\t\t\t\tpreviewer.playPreview({\n\t\t\t\t\ttarget: playBtn\n\t\t\t\t})\n\t\t\t}\n\t\t\t\n\t\t}\n\t}\n\tplaceTimePreviewPointer () {\n\t\tconst videoPreview = document.getElementsByClassName(videoStyles.record_preview)[0];\n\t\tconst video = videoPreview.querySelector('video');\n\t\tconst timeline = videoPreview.getElementsByClassName(videoStyles.preview_timeline)[0];\n\t\tconst timepoint = timeline.querySelector('h2');\n\t\tlet currentPos = video.currentTime;\n\t\tconst total = video.duration;\n\t\tconst width = timeline.clientWidth;\n\t\tconst position = Math.round(currentPos * (width / total));\n\t\ttimepoint.style.marginLeft = (position - 10) + 'px';\n\t\tconst timeTxt = document.getElementsByClassName(videoStyles.preview_time)[0];\n\t\tcurrentPos = total - currentPos;\n\t\tlet minutes = Math.round(currentPos / 60);\n\t\tlet seconds = Math.round(currentPos % 60);\n\t\tif (minutes < 10) {\n\t\t\tminutes = '0' + minutes;\n\t\t}\n\t\tif (seconds < 10) {\n\t\t\tseconds = '0' + seconds;\n\t\t}\n\t\ttimeTxt.innerHTML = `${minutes}:${seconds}`;\n\t\t// // console.log(video.currentTime);\n\t}\n\tplayPreview (evn) {\n\t\tconst previewer = this;\n\t\tevn.target.style.opacity = 1;\n\t\t// // console.log('preview');\n\t\tif (!this.playingPreview) {\n\t\t\tsetTimeout(() => {\n\t\t\t\ttry {\n\t\t\t\t\tconst playBtn = document.getElementsByClassName(videoStyles.preview_play)[0];\n\t\t\t\t\tplayBtn.style.opacity = 0;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.log(err);\n\t\t\t\t}\n\t\t\t}, 1200);\n\t\t\tthis.playingPreview = true;\n\t\t\t// video.load();\n\t\t\tpreviewer.video.play();\n\t\t\t// // console.log(video.duration, video.played, video.buffered);\n\t\t\tpreviewer.video.addEventListener('timeupdate', this.placeTimePreviewPointer);\n\t\t\tevn.target.classList.add(videoStyles.preview_pause);\n\t\t\tthis.placeTimePreviewPointer();\n\t\t} else {\n\t\t\tevn.target.classList.remove(videoStyles.preview_pause);\n\t\t\tthis.playingPreview = false;\n\t\t\tpreviewer.video.pause();\n\t\t\tpreviewer.video.removeEventListener('timeupdate', this.placeTimePreviewPointer);\n\t\t}\n\t}\n\tcomponentDidMount () {\n\t\tconst videoPreview = document.getElementsByClassName(videoStyles.record_preview)[0];\n\t\tconst video = videoPreview.querySelector('video');\n\t\tthis.video = video;\n\t\tthis.video.load();\n\t\t// video.play();\n\t\t// this.playingPreview = true;\n\t\tconst playBtn = document.getElementsByClassName(videoStyles.preview_play)[0];\n\t\tthis.playPreview({\n\t\t\ttarget: playBtn\n\t\t})\n\t\tconst player = this;\n\t\tthis.video.onended = function (evn) {\n\t\t\tconsole.log('ended');\n\t\t\tplayer.playingPreview = false;\n\t\t\tplayBtn.classList.remove(videoStyles.preview_pause);\n\t\t\tvideo.currentTime = 0;\n\t\t}\n\t\t// playBtn.classList.add(videoStyles.preview_pause);\n\t\t// video.addEventListener('timeupdate', this.placeTimePreviewPointer);\n\t}\n\tsave () {\n\t\tthis.close();\n\t}\n\tclose () {\n\t\tconst previewer = this;\n\t\tunmountComponentAtNode(document.getElementById('preview'));\n\t\tpreviewer.video.removeEventListener('timeupdate', this.placeTimePreviewPointer);\n\t}\n\trender() {\n\t\tlet clipUrl = this.clipUrl;\n\t\treturn (\n\t\t\t(\n\t\t\t\t<div className={ videoStyles.record_preview }>\n\t\t\t\t\t<div className={ videoStyles.preview_navigation }>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button className={ videoStyles.preview_nav_back }\n\t\t\t\t\t\t\t\t\tonClick={ (evn)=>{ this.close() } }></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button className={ videoStyles.preview_nav_delete }></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button className={ videoStyles.preview_nav_save }\n\t\t\t\t\t\t\t\t\tonClick={ (evn)=>{ this.save() } }></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<video muted>\n\t\t\t\t\t<source type=\"video/mp4\" src={ clipUrl }\n\t\t\t\t\t></source>\n\t\t\t\t\t</video>\n\t\t\t\t\t<div className={ videoStyles.preview_controls }>\n\t\t\t\t\t\t<button className={ videoStyles.preview_back }></button>\n\t\t\t\t\t\t<button className={ videoStyles.preview_play } onClick={(evn)=>{ this.playPreview(evn) }}></button>\n\t\t\t\t\t\t<button className={ videoStyles.preview_ford }></button>\n\t\t\t\t\t\t<button className={ videoStyles.preview_muted } onClick={ (evn)=>{ this.mute(evn) } }></button>\n\t\t\t\t\t\t<h1 className={ videoStyles.preview_time }>00:00</h1>\n\t\t\t\t\t\t<div className={ videoStyles.preview_timeline } onClick={ (evn)=>{ this.updatePreviewTime(evn)} }>\n\t\t\t\t\t\t\t<h2></h2>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t)\n\t\t)\n\t}\n}\n\nfunction VideoFrame () {\n\tconst loadingRef = useRef(null);\n\tconst triggerRef = useRef(null);\n\tconst galleryRef = useRef(null);\n\tconst webcamRef = useRef(null);\n\tconst canvasRef = useRef(null);\n\tconst backVideoRef = useRef(null);\n\tconst clips = [];\n\tlet render = false;\n\tlet recPressed = false;\n\tlet recording = false;\n\tlet currentMask;\n\tlet recordedframes = [];\n\n\tconst dimensions = [window.innerWidth, window.innerHeight];\n\tlet cropedDimensions;\n\t// console.log(dimensions);\n\n\tconst videoConstraints = {\n\t\twidth: dimensions[0],\n\t\theight: dimensions[1],\n\t\tfacingMode: \"user\"\n\t}\n\n\t// Navigation\n\n\tconst back = () => {\n\t\tstop();\n\t\tReactDOM.render(\n\t\t\t(\n\t\t\t\t<MainView></MainView>\n\t\t\t),\n\t\t\troot\n\t\t);\n\t}\n\tlet interval;\n\tlet clockInterval;\n\t/**\n\t * runBodySegment - startpoint for the background extraction\n\t */\n\tconst runBodySegment = async () => {\n\t\tconst toolBtn = document.getElementsByClassName(videoStyles.back_remove)[0];\n\t\tif (render) {\n\t\t\trender = false;\n\t\t\ttoolBtn.classList.remove(videoStyles.active);\n\t\t\tcanvasRef.current.style.display = 'none';\n\t\t\tclearInterval(interval);\n\t\t} else {\n\t\t\tloadingRef.current.style.visibility = 'visible';\n\t\t\ttoolBtn.classList.add(videoStyles.active);\n\t\t\trender = true;\n\t\t\tconst net = await bodyPix.load();\n\t\t\tif (backVideoRef.current) {\n\t\t\t\tbackVideoRef.current.play();\n\t\t\t}\n\t\t\tcanvasRef.current.style.display = 'block';\n\t\t\tinterval = setInterval(async function(){\n\t\t\t\tif (render) {\n\t\t\t\t\t// webcamRef.current.video.style.visibility = 'hidden';\n\t\t\t\t\tloadingRef.current.style.visibility = 'hidden';\n\t\t\t\t\tgalleryRef.current.style.filter = 'opacity(1)';\n\t\t\t\t\tdetect(net);\n\t\t\t\t} else if (!render) {\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t// console.log('no rendering');\n\t\t\t\t\tcanvasRef.current.style.display = 'none';\n\t\t\t\t}\n\t\t\t}, 29);\n\t\t}\n\t}\n\t/**\n\t * backMask - utility to apply the mask and compose the image using the video background\n\t * @param {ImageData} image \n\t * @param {ImageData} mask \n\t * @returns {ImageData} image - after the mask is applied\n\t */\n\tconst backMask = (image, mask) => {\n\t\t// // console.log(image, mask, backVideoRef.current);\n\t\tconst cv = document.createElement('canvas');\n\t\tlet imageData;\n\t\ttry {\n\t\t\tconst videoW = backVideoRef.current.videoWidth;\n\t\t\tconst videoH = backVideoRef.current.videoHeight;\n\t\t\tcv.style.width = image.height * (videoW / videoH);\n\t\t\tcv.style.height = image.height;\n\t\t\tcv.width = image.height * (videoW / videoH);;\n\t\t\tcv.height = image.height;\n\t\t\tconst ctx = cv.getContext('2d');\n\t\t\tctx.drawImage(backVideoRef.current, 0, 0, cv.width, cv.height);\n\t\t\timageData = ctx.getImageData(0, 0, image.width, image.height);\n\t\t} catch (err) {\n\t\t\t// console.log(err);\n\t\t\treturn null;\n\t\t}\n\t\t// // console.log(image, mask, imageData);\n\t\tfor (let i = 0; i < image.data.length; i+=4) {\n\t\t\tconst vector = [\n\t\t\t\tmask.data[i],\n\t\t\t\tmask.data[i + 1],\n\t\t\t\tmask.data[i + 2],\n\t\t\t\tmask.data[i + 3],\n\t\t\t]\n\t\t\tif (\n\t\t\t\t(vector[0] === 255 &&\n\t\t\t\tvector[1] === 255 &&\n\t\t\t\tvector[2] === 255)\n\t\t\t\t) {\n\t\t\t\t\timage.data[i] = imageData.data[i];\n\t\t\t\t\timage.data[i + 1] = imageData.data[i + 1];\n\t\t\t\t\timage.data[i + 2] = imageData.data[i + 2];\n\t\t\t\t\timage.data[i + 3] = imageData.data[i + 3];\n\t\t\t}\n\t\t}\n\t\treturn image;\n\t}\n\t/**\n\t * detect - prediction for each WebCam frame\n\t * @param {TensorFlowNet} net \n\t */\n\tconst detect = async (net) => {\n\t\tif (\n\t\t\ttypeof webcamRef.current !== \"undefined\" &&\n\t\t\twebcamRef.current !== null &&\n\t\t\twebcamRef.current.video.readyState === 4\n\t\t\t) {\n\t\t\t\tconst videoTrack = webcamRef.current.stream.getVideoTracks()[0];\n\t\t\t\tconst video = webcamRef.current.video;\n\t\t\t\tbackVideoRef.current.width = video.videoWidth;\n\t\t\t\tbackVideoRef.current.height = video.videoHeight;\n\t\t\t\tcropedDimensions = [video.videoWidth, video.videoHeight];\n\t\t\t\tvideoTrack.applyConstraints(videoConstraints);\n\t\t\t\tconst videoHeight = video.videoHeight;\n\t\t\t\tconst videoWidth = video.videoWidth;\n\t\t\t\twebcamRef.current.video.width = videoWidth;\n\t\t\t\twebcamRef.current.video.height = videoHeight;\n\t\t\t\tcanvasRef.current.width = videoWidth;\n\t\t\t\tcanvasRef.current.height = videoHeight;\n\t\t\t\tconst outStride = 16;\n\t\t\t\tconst segThreshold = 0.5;\n\t\t\t\tconst cv = document.createElement('canvas');\n\t\t\t\tcv.style.width = videoWidth;\n\t\t\t\tcv.style.height = videoHeight;\n\t\t\t\tcv.width = videoWidth;\n\t\t\t\tcv.height = videoHeight;\n\t\t\t\tconst ctx = cv.getContext('2d');\n\t\t\t\tctx.drawImage(video, 0, 0, cv.width, cv.height);\n\t\t\t\tconst imageData = ctx.getImageData(0, 0, cv.width, cv.height);\n\t\t\t\tconst person = await net.segmentPersonParts(video, outStride, segThreshold);\n\t\t\t\tconst coloredPart = bodyPix.toColoredPartMask(person);\n\t\t\t\tconst back = backMask(imageData, coloredPart);\n\t\t\t\tif (!back) {\n\t\t\t\t\t// console.log('no segmentation data');\n\t\t\t\t\tconst ctx2 = canvasRef.current.getContext('2d');\n\t\t\t\t\tctx2.putImageData(imageData, 0, 0);\n\t\t\t\t\tif (recording) {\n\t\t\t\t\t\trecordedframes.push(Array.from(imageData.data));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst ctx2 = canvasRef.current.getContext('2d');\n\t\t\t\t\tctx2.putImageData(back, 0, 0);\n\t\t\t\t\tif (recording) {\n\t\t\t\t\t\t// // console.log(back.width, back.height);\n\t\t\t\t\t\trecordedframes.push(Array.from(back.data));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t}\n\t/**\n\t * stop - Stop each streaming Track and sets render as false to stop detection\n\t */\n\tconst stopDetection = () => {\n\t\trender = false;\n\t}\n\tconst stop = () => {\n\t\trender = false;\n\t\tbackVideoRef.current.pause();\n\t\tconst tracks = webcamRef.current.stream.getTracks();\n\t\t// // console.log(tracks);\n\t\tfor (const track of tracks) {\n\t\t\ttrack.stop();\n\t\t}\n\t}\n\tconst checkVideoTrack = () => {\n\t}\n\tlet recordedChuncks = [];\n\tlet audioStream;\n\tconst chunkl = 256 * 64;\n\tconst recordAudio = function () {\n\t\taudioStream = webcamRef.current.stream;\n\t\tconst options = {\n\t\t\tmimeType: 'audio/webm'\n\t\t};\n\t\trecordedChuncks = [];\n\t\t// console.log(audioStream);\n\t\tvar context = new AudioContext({sampleRate: framerate});\n\t\tvar source = context.createMediaStreamSource(audioStream)\n\t\tvar processor = context.createScriptProcessor(chunkl, 1, 1);\n\t\tsource.connect(processor);\n\t\tprocessor.connect(context.destination);\n\t\tconst event = async function (e) {\n\t\t\tif (recording) {\n\t\t\t\t// // console.log(e.inputBuffer);\n\t\t\t\trecordedChuncks.push(...e.inputBuffer.getChannelData(0));\n\t\t\t} else {\n\t\t\t\tprocessor.onaudioprocess = null;\n\t\t\t}\n\t\t}\n\t\tprocessor.onaudioprocess = event;\n\t}\n\tlet minutes = 0;\n\tlet seconds = 0;\n\tlet mill = 0;\n\tconst activeClock = function () {\n\t\tminutes = 0;\n\t\tseconds = 0;\n\t\tconst clock = document.getElementsByClassName(videoStyles.record_time)[0];\n\t\tconst timeTXT = clock.querySelector('h1');\n\t\tconst timeButton = clock.querySelector('button');\n\t\ttimeButton.classList.add(videoStyles.recording);\n\t\tconst tic = function () {\n\t\t\tif (recording) {\n\t\t\t\tlet timeStr = ``;\n\t\t\t\t// modify the time\n\t\t\t\tseconds++;\n\t\t\t\tif (seconds > 59) {\n\t\t\t\t\tseconds = 0;\n\t\t\t\t\tminutes++;\n\t\t\t\t}\n\t\t\t\t// add padding for the minutes and seconds\n\t\t\t\tif (minutes < 10) {\n\t\t\t\t\ttimeStr += '0' + minutes;\n\t\t\t\t} else {\n\t\t\t\t\ttimeStr += minutes;\n\t\t\t\t}\n\t\t\t\ttimeStr += ':'\n\t\t\t\tif (seconds < 10) {\n\t\t\t\t\ttimeStr += '0' + seconds;\n\t\t\t\t} else {\n\t\t\t\t\ttimeStr += seconds;\n\t\t\t\t}\n\t\t\t\t// draw the time in browser\n\t\t\t\ttimeTXT.innerHTML = timeStr;\n\t\t\t} else {\n\t\t\t\ttimeButton.classList.remove(videoStyles.recording);\n\t\t\t\tclearInterval(clockInterval);\n\t\t\t}\n\t\t}\n\t\tclockInterval = setInterval(tic, 1000);\n\t}\n\tlet int;\n\tlet context = this;\n\tconst record = () => {\n\t\tconst triggerView = triggerRef.current;\n\t\t// console.log(triggerRef.current.querySelector('h1'));\n\t\tif (!recording && !recPressed) {\n\t\t\trecPressed = true;\n\t\t\trecordedframes = [];\n\t\t\tconst clock = document.getElementsByClassName(videoStyles.record_time)[0];\n\t\t\tconst timeTXT = clock.querySelector('h1');\n\t\t\ttimeTXT.innerHTML = '00:00';\n\t\t\tconst recButton = document.getElementsByClassName(videoStyles.recordBtn)[0];\n\t\t\trecButton.className = videoStyles.recordingBtn;\n\t\t\t// console.log();\n\t\t\t// console.log('animation init');\n\t\t\tlet count = 3;\n\t\t\t// console.log(videoStyles.trigger_anim);\n\t\t\tfunction x(){\n\t\t\t\ttriggerView.querySelector('h1').className = '';\n\t\t\t\tif (count === 0) {\n\t\t\t\t\t// console.log('stop trigger');\n\t\t\t\t\ttriggerView.style.display = 'none';\n\t\t\t\t\ttriggerView.querySelector('h1').className = '';\n\t\t\t\t\ttriggerView.querySelector('h1').classList.remove(videoStyles.trigger_anim);\n\t\t\t\t\tclearInterval(int);\n\t\t\t\t\trecording = true;\n\t\t\t\t\tactiveClock();\n\t\t\t\t\trecordAudio();\n\t\t\t\t} else {\n\t\t\t\t\ttriggerView.querySelector('h1').innerHTML = count + '!';\n\t\t\t\t\ttriggerView.querySelector('h1').classList.add(videoStyles.trigger_anim);\n\t\t\t\t\ttriggerView.style.display = 'block';\n\t\t\t\t\tcount--;\n\t\t\t\t}\n\t\t\t}\n\t\t\tx();\n\t\t\tint = setInterval(x, 1000);\n\t\t} else {\n\t\t\tconst recButton = document.getElementsByClassName(videoStyles.recordingBtn)[0];\n\t\t\trecButton.className = videoStyles.recordBtn;\n\t\t\trecording = false;\n\t\t\trecPressed = false;\n\t\t\tclearInterval(int);\n\t\t\ttriggerView.style.display = 'none';\n\t\t\tif (recordedframes.length > 0) {\n\t\t\t\tconst props = {\n\t\t\t\t\timages: recordedframes,\n\t\t\t\t\taudio: recordedChuncks,\n\t\t\t\t\tdimensions: cropedDimensions,\n\t\t\t\t\tduration: recordedChuncks.length / framerate,\n\t\t\t\t\tstart: 0,\n\t\t\t\t\tend: recordedChuncks.length / framerate\n\t\t\t\t}\n\t\t\t\trenderEditor(props, drawRecordedClips);\n\t\t\t} else {\n\t\t\t\tdeleteRecorded();\n\t\t\t}\n\t\t}\n\t}\n\tconst renderEditor = function (props, callback) {\n\t\trender = false;\n\t\tconst toolBtn = document.getElementsByClassName(videoStyles.back_remove)[0];\n\t\ttoolBtn.classList.remove(videoStyles.active);\n\t\tconst editor = document.getElementById('editor');\n\t\t// console.log(callback);\n\t\tReactDOM.render(\n\t\t\t(\n\t\t\t\t<RecorderEditor data={ props } callback={ callback } appendClip={ appendClip }></RecorderEditor>\n\t\t\t),\n\t\t\teditor\n\t\t);\n\t}\n\tconst uploadClip = async function (clip) {\n\t\tconst processId = uuidv4();\n\t\t// Uploading Audio fragments\n\t\tlet audioStartindex = Math.round(clip.start * (clip.recordedChuncks.length / clip.duration));\n\t\tlet audioEndindex = Math.round(clip.end * (clip.recordedChuncks.length / clip.duration));\n\t\tfor (let aIndex = audioStartindex; aIndex < audioEndindex; aIndex += chunkl) {\n\t\t\tconst diff = clip.recordedChuncks.length - aIndex;\n\t\t\tlet chunk;\n\t\t\tif (diff < chunkl) {\n\t\t\t\tchunk = clip.recordedChuncks.slice(aIndex, clip.recordedChuncks.length) \n\t\t\t} else {\n\t\t\t\tchunk = clip.recordedChuncks.slice(aIndex, aIndex + (chunkl));\n\t\t\t}\n\t\t\tconst req = await fetch(`http://127.0.0.1:3001/video/join`,\n\t\t\t\t{\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t'Authorization': localStorage.getItem('token')\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tid: processId,\n\t\t\t\t\t\ttype: 'audio',\n\t\t\t\t\t\tdata: chunk\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t);\n\t\t\t// console.log(await req.json());\n\t\t}\n\t\t// Uploading Video fragments\n\t\tlet videoStartindex = Math.round(clip.start * (clip.recordedframes.length / clip.duration));\n\t\tlet videoEndindex = Math.round(clip.end * (clip.recordedframes.length / clip.duration));\n\t\tfor (let vIndex = videoStartindex; vIndex < videoEndindex; vIndex++) {\n\t\t\tlet chunk;\n\t\t\tchunk = Array.from(clip.recordedframes[vIndex]);\n\t\t\tconst req = await fetch(`http://127.0.0.1:3001/video/join`,\n\t\t\t\t{\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t'Authorization': localStorage.getItem('token')\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tid: processId,\n\t\t\t\t\t\ttype: 'video',\n\t\t\t\t\t\tdimensions: clip.dimensions,\n\t\t\t\t\t\tdata: chunk\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t);\n\t\t\t// console.log(await req.json());\n\t\t}\n\t\t// Render the clip\n\t\tconst req = await fetch(`http://127.0.0.1:3001/video/join`,\n\t\t\t{\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'Authorization': localStorage.getItem('token')\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tid: processId,\n\t\t\t\t\ttype: 'render',\n\t\t\t\t\ttime: {\n\t\t\t\t\t\tminutes: minutes,\n\t\t\t\t\t\tseconds: seconds\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t);\n\t\tconst res = await req.json();\n\t\t// console.log(res);\n\t\treturn processId;\n\t}\n\tconst renderVideo = async function () {\n\t\tloadingRef.current.style.visibility = 'visible';\n\t\tconst renderedClips = [];\n\t\t// render each clip\n\t\tfor (let i = 0; i < clips.length; i++) {\n\t\t\tconst clipId = await uploadClip(clips[i]);\n\t\t\trenderedClips.push(clipId);\n\t\t}\n\t\t// Then merge all\n\t\tconst processId = uuidv4();\n\t\tconst req = await fetch(`http://127.0.0.1:3001/video/join`,\n\t\t\t{\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'Authorization': localStorage.getItem('token')\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tid: processId,\n\t\t\t\t\ttype: 'merge',\n\t\t\t\t\tclips: renderedClips\n\t\t\t\t})\n\t\t\t}\n\t\t);\n\t\tconst res = await req.json();\n\t\t// console.log(res);\n\t\treturn res.id;\n\t\t\n\t}\n\tconst save = async function () {\n\t\tconst renderedVideoId = await renderVideo();\n\t\tloadingRef.current.style.visibility = 'hidden';\n\t\topenPreview(`http://127.0.0.1:3001/video/clips/${renderedVideoId}`);\n\t}\n\tconst openPreview = function (url) {\n\t\tconst videoPreview = document.getElementById('preview');\n\t\tReactDOM.render(\n\t\t\t(\n\t\t\t\t<PreviewPlayer clipUrl={ url }></PreviewPlayer>\n\t\t\t),\n\t\t\tvideoPreview\n\t\t);\n\t}\n\tconst lowerSize = function () {\n\t\treturn cropedDimensions[0] > cropedDimensions[1] ? cropedDimensions[1] : cropedDimensions[0];\n\t}\n\tconst openClip = function (index) {\n\t\tconst props = {\n\t\t\timages: clips[index].recordedframes,\n\t\t\taudio: clips[index].recordedChuncks,\n\t\t\tdimensions: clips[index].dimensions,\n\t\t\tduration: clips[index].duration,\n\t\t\tindex: index,\n\t\t\tstart: clips[index].start,\n\t\t\tend: clips[index].end,\n\t\t}\n\t\trender = false;\n\t\trenderEditor(props, drawRecordedClips);\n\t}\n\tconst appendClip = function (data, index) {\n\t\tconst newData = {\n\t\t\trecordedChuncks: data.audio,\n\t\t\trecordedframes: data.images,\n\t\t\tdimensions: data.dimensions,\n\t\t\tduration: data.duration,\n\t\t\tstart: data.start,\n\t\t\tend: data.end\n\t\t}\n\t\tif (index !== undefined && index !== null) {\n\t\t\tnewData.index = index;\n\t\t\tclips[index] = newData;\n\t\t} else {\n\t\t\tclips.push(newData);\n\t\t}\n\t\tdeleteRecorded();\n\t}\n\tconst drawRecordedClips = function() {\n\t\tconst editor = document.getElementById('editor');\n\t\tlet clipIndex = 0;\n\t\tconst renderClips = clips.map((clip) => {\n\t\t\tconst frame = clip.recordedframes[0];\n\t\t\tconst canvas = document.createElement('canvas');\n\t\t\tcanvas.width = cropedDimensions[0];\n\t\t\tcanvas.height = cropedDimensions[1];\n\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\tconst imageData = ctx.createImageData(dimensions[0], dimensions[1]);\n\t\t\tfor (let i = 0; i < frame.length; i++) {\n\t\t\t\timageData.data[i] = frame[i];\n\t\t\t}\n\t\t\tctx.putImageData(imageData, 0, 0);\n\t\t\tconst cropped = ctx.getImageData(0, cropedDimensions[1] - lowerSize(), lowerSize(), lowerSize());\n\t\t\tctx.canvas.width = lowerSize();\n\t\t\tctx.canvas.height = lowerSize();\n\t\t\tctx.putImageData(cropped, 0, 0);\n\t\t\tconst dataUrl = ctx.canvas.toDataURL('image/png');\n\t\t\tconst tmpIndex = clipIndex;\n\t\t\tclipIndex++;\n\t\t\treturn (\n\t\t\t\t<li className={ videoStyles.clip } key={ uuidv4() }\n\t\t\t\t\tonClick={(evn) => { openClip(tmpIndex) }}>\n\t\t\t\t\t<img src={ dataUrl } alt=\"\" key={ uuidv4() }/>\n\t\t\t\t</li>\n\t\t\t);\n\t\t});\n\t\t// console.log(renderClips);\n\t\tReactDOM.render(\n\t\t\t(\n\t\t\t\t<div className={ videoStyles.clips }>\n\t\t\t\t\t<button className={ videoStyles.clips_back } onClick={ (evn)=>{ scrollClips(evn, -20) } }></button>\n\t\t\t\t\t<ul>\n\t\t\t\t\t{ renderClips }\n\t\t\t\t\t</ul>\n\t\t\t\t\t<button className={ videoStyles.clips_next } onClick={ (evn)=>{ scrollClips(evn, 20) } }></button>\n\t\t\t\t</div>\n\t\t\t),\n\t\t\teditor\n\t\t);\n\t}\n\tconst scrollClips = function (evn, steps) {\n\t\tconst parent = evn.target.parentNode;\n\t\tconst clipList = parent.querySelector('ul');\n\t\tlet scroll = clipList.scrollLeft;\n\t\tscroll += steps;\n\t\tclipList.scrollLeft = scroll;\n\t}\n\tconst deleteRecorded = function () {\n\t\trecordedChuncks = [];\n\t\trecordedframes = [];\n\t\tconst clock = document.getElementsByClassName(videoStyles.record_time)[0];\n\t\tconst timeTXT = clock.querySelector('h1');\n\t\ttimeTXT.innerHTML = '00:00';\n\t}\n\t// runBodySegment();\n\tnavigator.mediaDevices.getUserMedia({audio:true, video:false}).then(function(result) {\n\t\t\taudioStream = result;\n\t});\n\tconst renderView = function () {\n\t\treturn (\n\t\t\t<div className={ videoStyles.container }>\n\t\t\t<div id=\"preview\">\n\t\t\t</div>\n\t\t\t<div className={ videoStyles.loading } ref={loadingRef}>\n\t\t\t\t<h1></h1>\n\t\t\t\t<h2>Loading...</h2>\n\t\t\t</div>\n\t\t\t<div className={ videoStyles.trigger } ref={triggerRef}>\n\t\t\t\t<h1>3!</h1>\n\t\t\t</div>\n\t\t\t<div className={ videoStyles.back } onClick={() => { back() }}></div>\n\t\t\t\t<div className={ videoStyles.toolsMenu }>\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li className={ videoStyles.save } onClick={()=>{save()}}></li>\n\t\t\t\t\t\t<li className={ videoStyles.back_remove } onClick={ ()=>{runBodySegment()} }></li>\n\t\t\t\t\t\t<li className={ videoStyles.other }></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t<Webcam ref={webcamRef} className={ videoStyles.webcam }\n\t\t\t\t\tvideoConstraints={ videoConstraints }\n\t\t\t\t\t/>\n\t\t\t\t<canvas ref={canvasRef}\n\t\t\t\t\tclassName={ videoStyles.render_canvas }></canvas>\n\t\t\t\t<video \n\t\t\t\t\tref={ backVideoRef } className={ videoStyles.back_video }\n\t\t\t\t\t>\n\t\t\t\t\t<source src={ backVideo } type=\"video/mp4\"/>\n\t\t\t\t</video>\n\t\t\t\t<div className={ videoStyles.record_time }>\n\t\t\t\t\t<h1>00:00</h1>\n\t\t\t\t\t<button></button>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"editor\"></div>\n\t\t\t\t<div className={ videoStyles.controls }>\n\t\t\t\t\n\t\t\t\t\t<button className={ videoStyles.galleryBtn } onClick={()=> {}} ref={galleryRef}></button>\n\t\t\t\t\t<button className={ videoStyles.recordBtn } onClick={()=> { record() }}></button>\n\t\t\t\t\t<button className={ videoStyles.deleteBtn } onClick={()=> { deleteRecorded() } }></button>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n\treturn renderView();\n}\n\nexport class MainView extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {};\n\t}\n\tplayClip (url) {\n\t\tReactDOM.render(\n\t\t\t(\n\t\t\t\t<PreviewPlayer clipUrl={ url }></PreviewPlayer>\n\t\t\t),\n\t\t\tdocument.getElementById('preview')\n\t\t)\n\t}\n\trender () {\n\t\tconst videos = this.state.videos;\n\t\tlet rendered;\n\t\tconsole.log(videos);\n\t\tif (videos) {\n\t\t\trendered = videos.map((clip)=>{\n\t\t\t\tconst url = clip.src;\n\t\t\t\tconst sec = Math.round(Number(clip.duration));\n\t\t\t\treturn (\n\t\t\t\t\t<li className={ menuStyles.gallery_clip } key={ uuidv4() }>\n\t\t\t\t\t\t<h2>{ sec } sec</h2>\n\t\t\t\t\t\t<video src={ url } onClick={ ()=>{ this.playClip(url) } }></video>\n\t\t\t\t\t</li>\n\t\t\t\t\t\n\t\t\t\t)\n\t\t\t});\n\t\t}\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<div id=\"preview\">\n\t\t\t\t</div>\n\t\t\t\t<ul className={ menuStyles.gallery_container }>\n\t\t\t\t\t{ rendered }\n\t\t\t\t</ul>\n\t\t\t\t<div className={ menuStyles.menu }>\n\t\t\t\t\t<button className={ menuStyles.gallery } onClick={()=>{this.gallery()}}></button>\n\t\t\t\t\t<button className={ menuStyles.creator } onClick={()=>{this.creator()}}></button>\n\t\t\t\t\t<button className={ menuStyles.user } onClick={()=>{this.user()}}></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\tcomponentDidMount () {\n\t\tconst gallery = this;\n\t\tfetch(`http://127.0.0.1:3001/video/clips/urls`,\n\t\t{\n\t\t\tmethod: 'GET',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'Authorization': localStorage.getItem('token')\n\t\t\t}\n\t\t}).then(res=>{\n\t\t\tif (res.status !== 200) {\n\t\t\t\tthis.user();\n\t\t\t} else {\n\t\t\t\treturn res.json()\n\t\t\t}\n\t\t})\n\t\t.then(json=>{\n\t\t\t// console.log(json);\n\t\t\tconst state = gallery.state;\n\t\t\tstate.videos = json;\n\t\t\tthis.setState(state);\n\t\t});\n\t}\t\n\tgallery () {\n\n\t}\n\tcreator () {\n\t\tReactDOM.render(\n\t\t\t(\n\t\t\t\t<VideoFrame></VideoFrame>\n\t\t\t),\n\t\t\troot\n\t\t);\n\t}\n\tuser () {\n\t\tlocalStorage.removeItem('token');\n\t\twindow.location.reload();\n\t}\n}\n\nfunction App() {\n\tconst renderVideoCapture = () => {\n\t\tReact.render(\n\t\t\t(\n\t\t\t\t<VideoFrame>\n\t\t\t\t</VideoFrame>\n\t\t\t),\n\t\t\troot\n\t\t)\n\t};\n\tif (localStorage.getItem('token')) {\n\t\treturn (\n\t\t\t<MainView></MainView>\n\t\t  );\n\t} else {\n\t\treturn (\n\t\t\t<Login></Login>\n\t\t);\n\t}\n  \n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}